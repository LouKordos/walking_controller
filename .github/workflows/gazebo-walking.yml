name: gazebo-walking-0.3mps
on: [push]

jobs:
  run_controller:
    runs-on: ubuntu-20.04
    steps:
    - name: Checkout walking controller repo
      uses: actions/checkout@v2
    - run: time docker build -t loukordos/walking-controller:develop-ubuntu -f Dockerfile.ubuntu .
    - run: cd /home/runner/work/
    - name: Checkout biped sim repo
      uses: actions/checkout@master
      with:
        repository: LouKordos/simplified_biped
        ref: refs/heads/develop
    - run: time docker build -f Dockerfile.ubuntu-plugin -t loukordos/biped-sim:develop-ubuntu .
    - run: mkdir /home/runner/work/plot_data
    - run: docker run -v /home/runner/work/plot_data:/plot_data -e "RTF=0.3" -e "TERM=xterm-256color" -e "SKIP_PINNING=" -e "DISABLE_WEB_UI=" -e "RUNTIME_LIMIT=30" -d --net=host loukordos/walking-controller:develop-ubuntu
    - run: docker run -d --net=host -e "RTF=0.3" --name biped-sim loukordos/biped-sim:develop-ubuntu
    - run: sleep 30 && docker kill $(docker ps --quiet)