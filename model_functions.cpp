#include <eigen3/Eigen/Dense>
#include <eigen3/Eigen/QR>
#include <mutex>

using Eigen::MatrixXd;

double omega_desired = 0.9 * M_PI * 2;

#pragma region Constants

double Ixx_hip3 = 1.249e-04;
double Ixy_hip3 = 0;
double Ixz_hip3 = 0;

double Iyx_hip3 = 0;
double Iyy_hip3 = 9.241e-05;
double Iyz_hip3 = 0;

double Izx_hip3 = 0;
double Izy_hip3 = 0;
double Izz_hip3 = 9.241e-05;

double Ixx_hip2 = 1.249e-04;
double Ixy_hip2 = 0;
double Ixz_hip2 = 0;

double Iyx_hip2 = 0;
double Iyy_hip2 = 9.241e-05;
double Iyz_hip2 = 0;

double Izx_hip2 = 0;
double Izy_hip2 = 0;
double Izz_hip2 = 9.241e-05;


double Ixx_hip1 = 1.249e-04;
double Ixy_hip1 = 0;
double Ixz_hip1 = 0;

double Iyx_hip1 = 0;
double Iyy_hip1 = 9.241e-05;
double Iyz_hip1 = 0;

double Izx_hip1 = 0;
double Izy_hip1 = 0;
double Izz_hip1 = 9.241e-05;

double Ixx_ul = 7.982e-04;
double Ixy_ul = 0;
double Ixz_ul = 0;

double Iyx_ul = 0;
double Iyy_ul = 7.982e-04;
double Iyz_ul = 0;

double Izx_ul = 0;
double Izy_ul = 0;
double Izz_ul = 9.391e-05;


double Ixx_ll = 7.982e-04;
double Ixy_ll = 0;
double Ixz_ll = 0;

double Iyx_ll = 0;
double Iyy_ll = 7.982e-04;
double Iyz_ll = 0;

double Izx_ll = 0;
double Izy_ll = 0;
double Izz_ll = 9.391e-05;

double Ixx_foot = 2.733e-05;
double Ixy_foot = 0;
double Ixz_foot = 0;

double Iyx_foot = 0;
double Iyy_foot = 5.666e-06;
double Iyz_foot = 0;

double Izx_foot = 0;
double Izy_foot = 0;
double Izz_foot = 3.233e-05;

double l1 = 0;
double l2 = 0.145;
double l3 = 0.145;
double l4 = 0.41;
double l5 = 0.375;
double l6 = 0.04;

double l1_CoM = l1;
double l2_CoM = l2;
double l3_CoM = l3;
double l4_CoM = l4/2;
double l5_CoM = l5/2;
double l6_CoM = l6-0.01;

double m_hip3 = 0.1;
double m_hip2 = 0.1;
double m_hip1 = 0.1;
double m_ul = 0.1;
double m_ll = 0.1;
double m_foot = 0.01;

double g = 9.81;

double upper_torque_limit = 50;
double lower_torque_limit = -50;

#pragma endregion Constants

#pragma region Left leg

std::mutex q_left_leg_mutex, q_dot_left_leg_mutex;

Eigen::Matrix<double, 5, 1> q_left_leg;
Eigen::Matrix<double, 5, 1> q_dot_left_leg;

Eigen::Matrix<double, 5, 1> C_left_leg;
Eigen::Matrix<double, 5, 5> B_left_leg;
Eigen::Matrix<double, 5, 1> G_left_leg;

Eigen::Matrix<double, 3, 5> J_foot_left_leg;
Eigen::Matrix<double, 3, 5> J_foot_dot_left_leg;

Eigen::Matrix<double, 3, 3> Lambda_left_leg;

Eigen::Matrix<double, 3, 3> Kp_left_leg;
Eigen::Matrix<double, 3, 3> Kd_left_leg;

Eigen::Matrix<double, 5, 1> tau_ff_left_leg;
Eigen::Matrix<double, 5, 1> tau_setpoint_left_leg;

Eigen::Matrix<double, 3, 1> foot_pos_left_leg;
Eigen::Matrix<double, 3, 1> foot_vel_left_leg;

Eigen::Matrix<double, 3, 1> pos_desired_left_leg;
Eigen::Matrix<double, 3, 1> vel_desired_left_leg;
Eigen::Matrix<double, 3, 1> accel_desired_left_leg;

void update_q_left_leg(double theta1, double theta2, double theta3, double theta4, double theta5) {
    q_left_leg_mutex.lock();
    
    q_left_leg << theta1,
                  theta2,
                  theta3,
                  theta4,
                  theta5;

    q_left_leg_mutex.unlock();
}

void update_q_dot_left_leg(double theta1dot, double theta2dot, double theta3dot, double theta4dot, double theta5dot) {
    q_dot_left_leg_mutex.lock();
    
    q_dot_left_leg << theta1dot,
                      theta2dot,
                      theta3dot,
                      theta4dot,
                      theta5dot;

    q_dot_left_leg_mutex.unlock();
}

void update_B_left_leg(double theta_1, double theta_2, double theta_3, double theta_4, double theta_5, double thetadot1, double theta2dot, double theta3dot, double theta4dot, double theta5dot) {
    double B_1 = Izz_hip1 + Izz_hip2 + pow(l3_CoM,2)*m_hip1*pow(sin(theta_1),2)*pow(sin(theta_2),2) + pow(l3_CoM,2)*m_hip1*pow(sin(theta_2),2)*pow(cos(theta_1),2) + m_foot*pow((-l6_CoM*sin(theta_3 + theta_4 + theta_5)*sin(theta_1) - l6_CoM*sin(theta_2)*cos(theta_3 + theta_4 + theta_5)*cos(theta_1) - l3*sin(theta_2)*cos(theta_1) - l4*sin(theta_1)*sin(theta_3) - l4*sin(theta_2)*cos(theta_1)*cos(theta_3) - l5*sin(theta_3 + theta_4)*sin(theta_1) - l5*sin(theta_2)*cos(theta_3 + theta_4)*cos(theta_1)),2) + m_foot*pow((-l6_CoM*sin(theta_3 + theta_4 + theta_5)*cos(theta_1) + l6_CoM*sin(theta_1)*sin(theta_2)*cos(theta_3 + theta_4 + theta_5) + l3*sin(theta_1)*sin(theta_2) + l4*sin(theta_1)*sin(theta_2)*cos(theta_3) - l4*sin(theta_3)*cos(theta_1) - l5*sin(theta_3 + theta_4)*cos(theta_1) + l5*sin(theta_1)*sin(theta_2)*cos(theta_3 + theta_4)),2) + m_ll*pow((-l5_CoM*sin(theta_3 + theta_4)*sin(theta_1) - l5_CoM*sin(theta_2)*cos(theta_3 + theta_4)*cos(theta_1) - l3*sin(theta_2)*cos(theta_1) - l4*sin(theta_1)*sin(theta_3) - l4*sin(theta_2)*cos(theta_1)*cos(theta_3)),2) + m_ll*pow((-l5_CoM*sin(theta_3 + theta_4)*cos(theta_1) + l5_CoM*sin(theta_1)*sin(theta_2)*cos(theta_3 + theta_4) + l3*sin(theta_1)*sin(theta_2) + l4*sin(theta_1)*sin(theta_2)*cos(theta_3) - l4*sin(theta_3)*cos(theta_1)),2) + m_ul*pow((-l4_CoM*sin(theta_1)*sin(theta_3) - l4_CoM*sin(theta_2)*cos(theta_1)*cos(theta_3) - l3*sin(theta_2)*cos(theta_1)),2) + m_ul*pow((l4_CoM*sin(theta_1)*sin(theta_2)*cos(theta_3) - l4_CoM*sin(theta_3)*cos(theta_1) + l3*sin(theta_1)*sin(theta_2)),2) - (-Ixx_ul*sin(theta_2) + Izx_ul*cos(theta_2))*sin(theta_2) + (-Ixz_ul*sin(theta_2) + Izz_ul*cos(theta_2))*cos(theta_2) + (-sin(theta_3)*sin(theta_4)*cos(theta_2) + cos(theta_2)*cos(theta_3)*cos(theta_4))*(-Ixz_foot*sin(theta_2) + Iyz_foot*(sin(theta_3)*cos(theta_2)*cos(theta_4) + sin(theta_4)*cos(theta_2)*cos(theta_3)) + Izz_foot*(-sin(theta_3)*sin(theta_4)*cos(theta_2) + cos(theta_2)*cos(theta_3)*cos(theta_4))) + (sin(theta_3)*cos(theta_2)*cos(theta_4) + sin(theta_4)*cos(theta_2)*cos(theta_3))*(-Ixy_foot*sin(theta_2) + Iyy_foot*(sin(theta_3)*cos(theta_2)*cos(theta_4) + sin(theta_4)*cos(theta_2)*cos(theta_3)) + Izy_foot*(-sin(theta_3)*sin(theta_4)*cos(theta_2) + cos(theta_2)*cos(theta_3)*cos(theta_4))) - (-Ixx_foot*sin(theta_2) + Iyx_foot*(sin(theta_3)*cos(theta_2)*cos(theta_4) + sin(theta_4)*cos(theta_2)*cos(theta_3)) + Izx_foot*(-sin(theta_3)*sin(theta_4)*cos(theta_2) + cos(theta_2)*cos(theta_3)*cos(theta_4)))*sin(theta_2) - (-Ixx_ll*sin(theta_2) + Iyx_ll*sin(theta_3)*cos(theta_2) + Izx_ll*cos(theta_2)*cos(theta_3))*sin(theta_2) + (-Ixy_ll*sin(theta_2) + Iyy_ll*sin(theta_3)*cos(theta_2) + Izy_ll*cos(theta_2)*cos(theta_3))*sin(theta_3)*cos(theta_2) + (-Ixz_ll*sin(theta_2) + Iyz_ll*sin(theta_3)*cos(theta_2) + Izz_ll*cos(theta_2)*cos(theta_3))*cos(theta_2)*cos(theta_3);
    double B_2 = Izx_hip1*sin(theta_1) + Izy_hip1*cos(theta_1) - m_foot*(l6_CoM*cos(theta_3 + theta_4 + theta_5) + l3 + l4*cos(theta_3) + l5*cos(theta_3 + theta_4))*(-l6_CoM*sin(theta_3 + theta_4 + theta_5)*sin(theta_1) - l6_CoM*sin(theta_2)*cos(theta_3 + theta_4 + theta_5)*cos(theta_1) - l3*sin(theta_2)*cos(theta_1) - l4*sin(theta_1)*sin(theta_3) - l4*sin(theta_2)*cos(theta_1)*cos(theta_3) - l5*sin(theta_3 + theta_4)*sin(theta_1) - l5*sin(theta_2)*cos(theta_3 + theta_4)*cos(theta_1))*sin(theta_1)*cos(theta_2) - m_foot*(l6_CoM*cos(theta_3 + theta_4 + theta_5) + l3 + l4*cos(theta_3) + l5*cos(theta_3 + theta_4))*(-l6_CoM*sin(theta_3 + theta_4 + theta_5)*cos(theta_1) + l6_CoM*sin(theta_1)*sin(theta_2)*cos(theta_3 + theta_4 + theta_5) + l3*sin(theta_1)*sin(theta_2) + l4*sin(theta_1)*sin(theta_2)*cos(theta_3) - l4*sin(theta_3)*cos(theta_1) - l5*sin(theta_3 + theta_4)*cos(theta_1) + l5*sin(theta_1)*sin(theta_2)*cos(theta_3 + theta_4))*cos(theta_1)*cos(theta_2) - m_ll*(l5_CoM*cos(theta_3 + theta_4) + l3 + l4*cos(theta_3))*(-l5_CoM*sin(theta_3 + theta_4)*sin(theta_1) - l5_CoM*sin(theta_2)*cos(theta_3 + theta_4)*cos(theta_1) - l3*sin(theta_2)*cos(theta_1) - l4*sin(theta_1)*sin(theta_3) - l4*sin(theta_2)*cos(theta_1)*cos(theta_3))*sin(theta_1)*cos(theta_2) - m_ll*(l5_CoM*cos(theta_3 + theta_4) + l3 + l4*cos(theta_3))*(-l5_CoM*sin(theta_3 + theta_4)*cos(theta_1) + l5_CoM*sin(theta_1)*sin(theta_2)*cos(theta_3 + theta_4) + l3*sin(theta_1)*sin(theta_2) + l4*sin(theta_1)*sin(theta_2)*cos(theta_3) - l4*sin(theta_3)*cos(theta_1))*cos(theta_1)*cos(theta_2) - m_ul*(l4_CoM*cos(theta_3) + l3)*(-l4_CoM*sin(theta_1)*sin(theta_3) - l4_CoM*sin(theta_2)*cos(theta_1)*cos(theta_3) - l3*sin(theta_2)*cos(theta_1))*sin(theta_1)*cos(theta_2) - m_ul*(l4_CoM*cos(theta_3) + l3)*(l4_CoM*sin(theta_1)*sin(theta_2)*cos(theta_3) - l4_CoM*sin(theta_3)*cos(theta_1) + l3*sin(theta_1)*sin(theta_2))*cos(theta_1)*cos(theta_2) + (-Ixx_ul*sin(theta_2) + Izx_ul*cos(theta_2))*sin(theta_1)*cos(theta_2) + (-Ixy_ul*sin(theta_2) + Izy_ul*cos(theta_2))*cos(theta_1) + (-Ixz_ul*sin(theta_2) + Izz_ul*cos(theta_2))*sin(theta_1)*sin(theta_2) + (-(sin(theta_1)*sin(theta_2)*sin(theta_3) + cos(theta_1)*cos(theta_3))*sin(theta_4) + (sin(theta_1)*sin(theta_2)*cos(theta_3) - sin(theta_3)*cos(theta_1))*cos(theta_4))*(-Ixz_foot*sin(theta_2) + Iyz_foot*(sin(theta_3)*cos(theta_2)*cos(theta_4) + sin(theta_4)*cos(theta_2)*cos(theta_3)) + Izz_foot*(-sin(theta_3)*sin(theta_4)*cos(theta_2) + cos(theta_2)*cos(theta_3)*cos(theta_4))) + ((sin(theta_1)*sin(theta_2)*sin(theta_3) + cos(theta_1)*cos(theta_3))*cos(theta_4) + (sin(theta_1)*sin(theta_2)*cos(theta_3) - sin(theta_3)*cos(theta_1))*sin(theta_4))*(-Ixy_foot*sin(theta_2) + Iyy_foot*(sin(theta_3)*cos(theta_2)*cos(theta_4) + sin(theta_4)*cos(theta_2)*cos(theta_3)) + Izy_foot*(-sin(theta_3)*sin(theta_4)*cos(theta_2) + cos(theta_2)*cos(theta_3)*cos(theta_4))) + (sin(theta_1)*sin(theta_2)*sin(theta_3) + cos(theta_1)*cos(theta_3))*(-Ixy_ll*sin(theta_2) + Iyy_ll*sin(theta_3)*cos(theta_2) + Izy_ll*cos(theta_2)*cos(theta_3)) + (sin(theta_1)*sin(theta_2)*cos(theta_3) - sin(theta_3)*cos(theta_1))*(-Ixz_ll*sin(theta_2) + Iyz_ll*sin(theta_3)*cos(theta_2) + Izz_ll*cos(theta_2)*cos(theta_3)) + (-Ixx_foot*sin(theta_2) + Iyx_foot*(sin(theta_3)*cos(theta_2)*cos(theta_4) + sin(theta_4)*cos(theta_2)*cos(theta_3)) + Izx_foot*(-sin(theta_3)*sin(theta_4)*cos(theta_2) + cos(theta_2)*cos(theta_3)*cos(theta_4)))*sin(theta_1)*cos(theta_2) + (-Ixx_ll*sin(theta_2) + Iyx_ll*sin(theta_3)*cos(theta_2) + Izx_ll*cos(theta_2)*cos(theta_3))*sin(theta_1)*cos(theta_2);
    double B_3 = l4_CoM*m_ul*(-sin(theta_1)*cos(theta_3) + sin(theta_2)*sin(theta_3)*cos(theta_1))*(l4_CoM*sin(theta_1)*sin(theta_2)*cos(theta_3) - l4_CoM*sin(theta_3)*cos(theta_1) + l3*sin(theta_1)*sin(theta_2)) + l4_CoM*m_ul*(sin(theta_1)*sin(theta_2)*sin(theta_3) + cos(theta_1)*cos(theta_3))*(-l4_CoM*sin(theta_1)*sin(theta_3) - l4_CoM*sin(theta_2)*cos(theta_1)*cos(theta_3) - l3*sin(theta_2)*cos(theta_1)) + m_foot*(l6_CoM*(sin(theta_3 + theta_4 + theta_5)*sin(theta_1)*sin(theta_2) + cos(theta_3 + theta_4 + theta_5)*cos(theta_1)) + l4*(sin(theta_1)*sin(theta_2)*sin(theta_3) + cos(theta_1)*cos(theta_3)) + l5*(sin(theta_3 + theta_4)*sin(theta_1)*sin(theta_2) + cos(theta_3 + theta_4)*cos(theta_1)))*(-l6_CoM*sin(theta_3 + theta_4 + theta_5)*sin(theta_1) - l6_CoM*sin(theta_2)*cos(theta_3 + theta_4 + theta_5)*cos(theta_1) - l3*sin(theta_2)*cos(theta_1) - l4*sin(theta_1)*sin(theta_3) - l4*sin(theta_2)*cos(theta_1)*cos(theta_3) - l5*sin(theta_3 + theta_4)*sin(theta_1) - l5*sin(theta_2)*cos(theta_3 + theta_4)*cos(theta_1)) + m_foot*(l6_CoM*sin(theta_3 + theta_4 + theta_5)*sin(theta_2)*cos(theta_1) - l6_CoM*sin(theta_1)*cos(theta_3 + theta_4 + theta_5) - l4*sin(theta_1)*cos(theta_3) + l4*sin(theta_2)*sin(theta_3)*cos(theta_1) + l5*sin(theta_3 + theta_4)*sin(theta_2)*cos(theta_1) - l5*sin(theta_1)*cos(theta_3 + theta_4))*(-l6_CoM*sin(theta_3 + theta_4 + theta_5)*cos(theta_1) + l6_CoM*sin(theta_1)*sin(theta_2)*cos(theta_3 + theta_4 + theta_5) + l3*sin(theta_1)*sin(theta_2) + l4*sin(theta_1)*sin(theta_2)*cos(theta_3) - l4*sin(theta_3)*cos(theta_1) - l5*sin(theta_3 + theta_4)*cos(theta_1) + l5*sin(theta_1)*sin(theta_2)*cos(theta_3 + theta_4)) + m_ll*(l5_CoM*(sin(theta_3 + theta_4)*sin(theta_1)*sin(theta_2) + cos(theta_3 + theta_4)*cos(theta_1)) + l4*(sin(theta_1)*sin(theta_2)*sin(theta_3) + cos(theta_1)*cos(theta_3)))*(-l5_CoM*sin(theta_3 + theta_4)*sin(theta_1) - l5_CoM*sin(theta_2)*cos(theta_3 + theta_4)*cos(theta_1) - l3*sin(theta_2)*cos(theta_1) - l4*sin(theta_1)*sin(theta_3) - l4*sin(theta_2)*cos(theta_1)*cos(theta_3)) + m_ll*(l5_CoM*sin(theta_3 + theta_4)*sin(theta_2)*cos(theta_1) - l5_CoM*sin(theta_1)*cos(theta_3 + theta_4) - l4*sin(theta_1)*cos(theta_3) + l4*sin(theta_2)*sin(theta_3)*cos(theta_1))*(-l5_CoM*sin(theta_3 + theta_4)*cos(theta_1) + l5_CoM*sin(theta_1)*sin(theta_2)*cos(theta_3 + theta_4) + l3*sin(theta_1)*sin(theta_2) + l4*sin(theta_1)*sin(theta_2)*cos(theta_3) - l4*sin(theta_3)*cos(theta_1)) + (-Ixx_ul*sin(theta_2) + Izx_ul*cos(theta_2))*cos(theta_1)*cos(theta_2) - (-Ixy_ul*sin(theta_2) + Izy_ul*cos(theta_2))*sin(theta_1) + (-Ixz_ul*sin(theta_2) + Izz_ul*cos(theta_2))*sin(theta_2)*cos(theta_1) + ((sin(theta_1)*sin(theta_3) + sin(theta_2)*cos(theta_1)*cos(theta_3))*sin(theta_4) + (-sin(theta_1)*cos(theta_3) + sin(theta_2)*sin(theta_3)*cos(theta_1))*cos(theta_4))*(-Ixy_foot*sin(theta_2) + Iyy_foot*(sin(theta_3)*cos(theta_2)*cos(theta_4) + sin(theta_4)*cos(theta_2)*cos(theta_3)) + Izy_foot*(-sin(theta_3)*sin(theta_4)*cos(theta_2) + cos(theta_2)*cos(theta_3)*cos(theta_4))) + ((sin(theta_1)*sin(theta_3) + sin(theta_2)*cos(theta_1)*cos(theta_3))*cos(theta_4) - (-sin(theta_1)*cos(theta_3) + sin(theta_2)*sin(theta_3)*cos(theta_1))*sin(theta_4))*(-Ixz_foot*sin(theta_2) + Iyz_foot*(sin(theta_3)*cos(theta_2)*cos(theta_4) + sin(theta_4)*cos(theta_2)*cos(theta_3)) + Izz_foot*(-sin(theta_3)*sin(theta_4)*cos(theta_2) + cos(theta_2)*cos(theta_3)*cos(theta_4))) + (sin(theta_1)*sin(theta_3) + sin(theta_2)*cos(theta_1)*cos(theta_3))*(-Ixz_ll*sin(theta_2) + Iyz_ll*sin(theta_3)*cos(theta_2) + Izz_ll*cos(theta_2)*cos(theta_3)) + (-sin(theta_1)*cos(theta_3) + sin(theta_2)*sin(theta_3)*cos(theta_1))*(-Ixy_ll*sin(theta_2) + Iyy_ll*sin(theta_3)*cos(theta_2) + Izy_ll*cos(theta_2)*cos(theta_3)) + (-Ixx_foot*sin(theta_2) + Iyx_foot*(sin(theta_3)*cos(theta_2)*cos(theta_4) + sin(theta_4)*cos(theta_2)*cos(theta_3)) + Izx_foot*(-sin(theta_3)*sin(theta_4)*cos(theta_2) + cos(theta_2)*cos(theta_3)*cos(theta_4)))*cos(theta_1)*cos(theta_2) + (-Ixx_ll*sin(theta_2) + Iyx_ll*sin(theta_3)*cos(theta_2) + Izx_ll*cos(theta_2)*cos(theta_3))*cos(theta_1)*cos(theta_2);
    double B_4 = l5_CoM*m_ll*(sin(theta_3 + theta_4)*sin(theta_1)*sin(theta_2) + cos(theta_3 + theta_4)*cos(theta_1))*(-l5_CoM*sin(theta_3 + theta_4)*sin(theta_1) - l5_CoM*sin(theta_2)*cos(theta_3 + theta_4)*cos(theta_1) - l3*sin(theta_2)*cos(theta_1) - l4*sin(theta_1)*sin(theta_3) - l4*sin(theta_2)*cos(theta_1)*cos(theta_3)) + l5_CoM*m_ll*(sin(theta_3 + theta_4)*sin(theta_2)*cos(theta_1) - sin(theta_1)*cos(theta_3 + theta_4))*(-l5_CoM*sin(theta_3 + theta_4)*cos(theta_1) + l5_CoM*sin(theta_1)*sin(theta_2)*cos(theta_3 + theta_4) + l3*sin(theta_1)*sin(theta_2) + l4*sin(theta_1)*sin(theta_2)*cos(theta_3) - l4*sin(theta_3)*cos(theta_1)) + m_foot*(l6_CoM*(sin(theta_3 + theta_4 + theta_5)*sin(theta_1)*sin(theta_2) + cos(theta_3 + theta_4 + theta_5)*cos(theta_1)) + l5*(sin(theta_3 + theta_4)*sin(theta_1)*sin(theta_2) + cos(theta_3 + theta_4)*cos(theta_1)))*(-l6_CoM*sin(theta_3 + theta_4 + theta_5)*sin(theta_1) - l6_CoM*sin(theta_2)*cos(theta_3 + theta_4 + theta_5)*cos(theta_1) - l3*sin(theta_2)*cos(theta_1) - l4*sin(theta_1)*sin(theta_3) - l4*sin(theta_2)*cos(theta_1)*cos(theta_3) - l5*sin(theta_3 + theta_4)*sin(theta_1) - l5*sin(theta_2)*cos(theta_3 + theta_4)*cos(theta_1)) + m_foot*(l6_CoM*sin(theta_3 + theta_4 + theta_5)*sin(theta_2)*cos(theta_1) - l6_CoM*sin(theta_1)*cos(theta_3 + theta_4 + theta_5) + l5*sin(theta_3 + theta_4)*sin(theta_2)*cos(theta_1) - l5*sin(theta_1)*cos(theta_3 + theta_4))*(-l6_CoM*sin(theta_3 + theta_4 + theta_5)*cos(theta_1) + l6_CoM*sin(theta_1)*sin(theta_2)*cos(theta_3 + theta_4 + theta_5) + l3*sin(theta_1)*sin(theta_2) + l4*sin(theta_1)*sin(theta_2)*cos(theta_3) - l4*sin(theta_3)*cos(theta_1) - l5*sin(theta_3 + theta_4)*cos(theta_1) + l5*sin(theta_1)*sin(theta_2)*cos(theta_3 + theta_4)) + ((sin(theta_1)*sin(theta_3) + sin(theta_2)*cos(theta_1)*cos(theta_3))*sin(theta_4) + (-sin(theta_1)*cos(theta_3) + sin(theta_2)*sin(theta_3)*cos(theta_1))*cos(theta_4))*(-Ixy_foot*sin(theta_2) + Iyy_foot*(sin(theta_3)*cos(theta_2)*cos(theta_4) + sin(theta_4)*cos(theta_2)*cos(theta_3)) + Izy_foot*(-sin(theta_3)*sin(theta_4)*cos(theta_2) + cos(theta_2)*cos(theta_3)*cos(theta_4))) + ((sin(theta_1)*sin(theta_3) + sin(theta_2)*cos(theta_1)*cos(theta_3))*cos(theta_4) - (-sin(theta_1)*cos(theta_3) + sin(theta_2)*sin(theta_3)*cos(theta_1))*sin(theta_4))*(-Ixz_foot*sin(theta_2) + Iyz_foot*(sin(theta_3)*cos(theta_2)*cos(theta_4) + sin(theta_4)*cos(theta_2)*cos(theta_3)) + Izz_foot*(-sin(theta_3)*sin(theta_4)*cos(theta_2) + cos(theta_2)*cos(theta_3)*cos(theta_4))) + (sin(theta_1)*sin(theta_3) + sin(theta_2)*cos(theta_1)*cos(theta_3))*(-Ixz_ll*sin(theta_2) + Iyz_ll*sin(theta_3)*cos(theta_2) + Izz_ll*cos(theta_2)*cos(theta_3)) + (-sin(theta_1)*cos(theta_3) + sin(theta_2)*sin(theta_3)*cos(theta_1))*(-Ixy_ll*sin(theta_2) + Iyy_ll*sin(theta_3)*cos(theta_2) + Izy_ll*cos(theta_2)*cos(theta_3)) + (-Ixx_foot*sin(theta_2) + Iyx_foot*(sin(theta_3)*cos(theta_2)*cos(theta_4) + sin(theta_4)*cos(theta_2)*cos(theta_3)) + Izx_foot*(-sin(theta_3)*sin(theta_4)*cos(theta_2) + cos(theta_2)*cos(theta_3)*cos(theta_4)))*cos(theta_1)*cos(theta_2) + (-Ixx_ll*sin(theta_2) + Iyx_ll*sin(theta_3)*cos(theta_2) + Izx_ll*cos(theta_2)*cos(theta_3))*cos(theta_1)*cos(theta_2);
    double B_5 = l6_CoM*m_foot*(sin(theta_3 + theta_4 + theta_5)*sin(theta_1)*sin(theta_2) + cos(theta_3 + theta_4 + theta_5)*cos(theta_1))*(-l6_CoM*sin(theta_3 + theta_4 + theta_5)*sin(theta_1) - l6_CoM*sin(theta_2)*cos(theta_3 + theta_4 + theta_5)*cos(theta_1) - l3*sin(theta_2)*cos(theta_1) - l4*sin(theta_1)*sin(theta_3) - l4*sin(theta_2)*cos(theta_1)*cos(theta_3) - l5*sin(theta_3 + theta_4)*sin(theta_1) - l5*sin(theta_2)*cos(theta_3 + theta_4)*cos(theta_1)) + l6_CoM*m_foot*(sin(theta_3 + theta_4 + theta_5)*sin(theta_2)*cos(theta_1) - sin(theta_1)*cos(theta_3 + theta_4 + theta_5))*(-l6_CoM*sin(theta_3 + theta_4 + theta_5)*cos(theta_1) + l6_CoM*sin(theta_1)*sin(theta_2)*cos(theta_3 + theta_4 + theta_5) + l3*sin(theta_1)*sin(theta_2) + l4*sin(theta_1)*sin(theta_2)*cos(theta_3) - l4*sin(theta_3)*cos(theta_1) - l5*sin(theta_3 + theta_4)*cos(theta_1) + l5*sin(theta_1)*sin(theta_2)*cos(theta_3 + theta_4)) + ((sin(theta_1)*sin(theta_3) + sin(theta_2)*cos(theta_1)*cos(theta_3))*sin(theta_4) + (-sin(theta_1)*cos(theta_3) + sin(theta_2)*sin(theta_3)*cos(theta_1))*cos(theta_4))*(-Ixy_foot*sin(theta_2) + Iyy_foot*(sin(theta_3)*cos(theta_2)*cos(theta_4) + sin(theta_4)*cos(theta_2)*cos(theta_3)) + Izy_foot*(-sin(theta_3)*sin(theta_4)*cos(theta_2) + cos(theta_2)*cos(theta_3)*cos(theta_4))) + ((sin(theta_1)*sin(theta_3) + sin(theta_2)*cos(theta_1)*cos(theta_3))*cos(theta_4) - (-sin(theta_1)*cos(theta_3) + sin(theta_2)*sin(theta_3)*cos(theta_1))*sin(theta_4))*(-Ixz_foot*sin(theta_2) + Iyz_foot*(sin(theta_3)*cos(theta_2)*cos(theta_4) + sin(theta_4)*cos(theta_2)*cos(theta_3)) + Izz_foot*(-sin(theta_3)*sin(theta_4)*cos(theta_2) + cos(theta_2)*cos(theta_3)*cos(theta_4))) + (-Ixx_foot*sin(theta_2) + Iyx_foot*(sin(theta_3)*cos(theta_2)*cos(theta_4) + sin(theta_4)*cos(theta_2)*cos(theta_3)) + Izx_foot*(-sin(theta_3)*sin(theta_4)*cos(theta_2) + cos(theta_2)*cos(theta_3)*cos(theta_4)))*cos(theta_1)*cos(theta_2);
    double B_6 = Ixz_hip1*sin(theta_1) + Iyz_hip1*cos(theta_1) - m_foot*(l6_CoM*cos(theta_3 + theta_4 + theta_5) + l3 + l4*cos(theta_3) + l5*cos(theta_3 + theta_4))*(-l6_CoM*sin(theta_3 + theta_4 + theta_5)*sin(theta_1) - l6_CoM*sin(theta_2)*cos(theta_3 + theta_4 + theta_5)*cos(theta_1) - l3*sin(theta_2)*cos(theta_1) - l4*sin(theta_1)*sin(theta_3) - l4*sin(theta_2)*cos(theta_1)*cos(theta_3) - l5*sin(theta_3 + theta_4)*sin(theta_1) - l5*sin(theta_2)*cos(theta_3 + theta_4)*cos(theta_1))*sin(theta_1)*cos(theta_2) - m_foot*(l6_CoM*cos(theta_3 + theta_4 + theta_5) + l3 + l4*cos(theta_3) + l5*cos(theta_3 + theta_4))*(-l6_CoM*sin(theta_3 + theta_4 + theta_5)*cos(theta_1) + l6_CoM*sin(theta_1)*sin(theta_2)*cos(theta_3 + theta_4 + theta_5) + l3*sin(theta_1)*sin(theta_2) + l4*sin(theta_1)*sin(theta_2)*cos(theta_3) - l4*sin(theta_3)*cos(theta_1) - l5*sin(theta_3 + theta_4)*cos(theta_1) + l5*sin(theta_1)*sin(theta_2)*cos(theta_3 + theta_4))*cos(theta_1)*cos(theta_2) - m_ll*(l5_CoM*cos(theta_3 + theta_4) + l3 + l4*cos(theta_3))*(-l5_CoM*sin(theta_3 + theta_4)*sin(theta_1) - l5_CoM*sin(theta_2)*cos(theta_3 + theta_4)*cos(theta_1) - l3*sin(theta_2)*cos(theta_1) - l4*sin(theta_1)*sin(theta_3) - l4*sin(theta_2)*cos(theta_1)*cos(theta_3))*sin(theta_1)*cos(theta_2) - m_ll*(l5_CoM*cos(theta_3 + theta_4) + l3 + l4*cos(theta_3))*(-l5_CoM*sin(theta_3 + theta_4)*cos(theta_1) + l5_CoM*sin(theta_1)*sin(theta_2)*cos(theta_3 + theta_4) + l3*sin(theta_1)*sin(theta_2) + l4*sin(theta_1)*sin(theta_2)*cos(theta_3) - l4*sin(theta_3)*cos(theta_1))*cos(theta_1)*cos(theta_2) - m_ul*(l4_CoM*cos(theta_3) + l3)*(-l4_CoM*sin(theta_1)*sin(theta_3) - l4_CoM*sin(theta_2)*cos(theta_1)*cos(theta_3) - l3*sin(theta_2)*cos(theta_1))*sin(theta_1)*cos(theta_2) - m_ul*(l4_CoM*cos(theta_3) + l3)*(l4_CoM*sin(theta_1)*sin(theta_2)*cos(theta_3) - l4_CoM*sin(theta_3)*cos(theta_1) + l3*sin(theta_1)*sin(theta_2))*cos(theta_1)*cos(theta_2) + (-sin(theta_3)*sin(theta_4)*cos(theta_2) + cos(theta_2)*cos(theta_3)*cos(theta_4))*(Ixz_foot*sin(theta_1)*cos(theta_2) + Iyz_foot*((sin(theta_1)*sin(theta_2)*sin(theta_3) + cos(theta_1)*cos(theta_3))*cos(theta_4) + (sin(theta_1)*sin(theta_2)*cos(theta_3) - sin(theta_3)*cos(theta_1))*sin(theta_4)) + Izz_foot*(-(sin(theta_1)*sin(theta_2)*sin(theta_3) + cos(theta_1)*cos(theta_3))*sin(theta_4) + (sin(theta_1)*sin(theta_2)*cos(theta_3) - sin(theta_3)*cos(theta_1))*cos(theta_4))) + (sin(theta_3)*cos(theta_2)*cos(theta_4) + sin(theta_4)*cos(theta_2)*cos(theta_3))*(Ixy_foot*sin(theta_1)*cos(theta_2) + Iyy_foot*((sin(theta_1)*sin(theta_2)*sin(theta_3) + cos(theta_1)*cos(theta_3))*cos(theta_4) + (sin(theta_1)*sin(theta_2)*cos(theta_3) - sin(theta_3)*cos(theta_1))*sin(theta_4)) + Izy_foot*(-(sin(theta_1)*sin(theta_2)*sin(theta_3) + cos(theta_1)*cos(theta_3))*sin(theta_4) + (sin(theta_1)*sin(theta_2)*cos(theta_3) - sin(theta_3)*cos(theta_1))*cos(theta_4))) - (Ixx_foot*sin(theta_1)*cos(theta_2) + Iyx_foot*((sin(theta_1)*sin(theta_2)*sin(theta_3) + cos(theta_1)*cos(theta_3))*cos(theta_4) + (sin(theta_1)*sin(theta_2)*cos(theta_3) - sin(theta_3)*cos(theta_1))*sin(theta_4)) + Izx_foot*(-(sin(theta_1)*sin(theta_2)*sin(theta_3) + cos(theta_1)*cos(theta_3))*sin(theta_4) + (sin(theta_1)*sin(theta_2)*cos(theta_3) - sin(theta_3)*cos(theta_1))*cos(theta_4)))*sin(theta_2) - (Ixx_ll*sin(theta_1)*cos(theta_2) + Iyx_ll*(sin(theta_1)*sin(theta_2)*sin(theta_3) + cos(theta_1)*cos(theta_3)) + Izx_ll*(sin(theta_1)*sin(theta_2)*cos(theta_3) - sin(theta_3)*cos(theta_1)))*sin(theta_2) - (Ixx_ul*sin(theta_1)*cos(theta_2) + Iyx_ul*cos(theta_1) + Izx_ul*sin(theta_1)*sin(theta_2))*sin(theta_2) + (Ixy_ll*sin(theta_1)*cos(theta_2) + Iyy_ll*(sin(theta_1)*sin(theta_2)*sin(theta_3) + cos(theta_1)*cos(theta_3)) + Izy_ll*(sin(theta_1)*sin(theta_2)*cos(theta_3) - sin(theta_3)*cos(theta_1)))*sin(theta_3)*cos(theta_2) + (Ixz_ll*sin(theta_1)*cos(theta_2) + Iyz_ll*(sin(theta_1)*sin(theta_2)*sin(theta_3) + cos(theta_1)*cos(theta_3)) + Izz_ll*(sin(theta_1)*sin(theta_2)*cos(theta_3) - sin(theta_3)*cos(theta_1)))*cos(theta_2)*cos(theta_3) + (Ixz_ul*sin(theta_1)*cos(theta_2) + Iyz_ul*cos(theta_1) + Izz_ul*sin(theta_1)*sin(theta_2))*cos(theta_2);
    double B_7 = pow(l3_CoM,2)*m_hip1*pow(sin(theta_1),2)*pow(cos(theta_2),2) + pow(l3_CoM,2)*m_hip1*pow(sin(theta_2),2) + pow(l3_CoM,2)*m_hip1*pow(cos(theta_1),2)*pow(cos(theta_2),2) + m_foot*pow((l6_CoM*cos(theta_3 + theta_4 + theta_5) + l3 + l4*cos(theta_3) + l5*cos(theta_3 + theta_4)),2)*pow(sin(theta_1),2)*pow(cos(theta_2),2) + m_foot*pow((l6_CoM*cos(theta_3 + theta_4 + theta_5) + l3 + l4*cos(theta_3) + l5*cos(theta_3 + theta_4)),2)*pow(sin(theta_2),2) + m_foot*pow((l6_CoM*cos(theta_3 + theta_4 + theta_5) + l3 + l4*cos(theta_3) + l5*cos(theta_3 + theta_4)),2)*pow(cos(theta_1),2)*pow(cos(theta_2),2) + m_ll*pow((l5_CoM*cos(theta_3 + theta_4) + l3 + l4*cos(theta_3)),2)*pow(sin(theta_1),2)*pow(cos(theta_2),2) + m_ll*pow((l5_CoM*cos(theta_3 + theta_4) + l3 + l4*cos(theta_3)),2)*pow(sin(theta_2),2) + m_ll*pow((l5_CoM*cos(theta_3 + theta_4) + l3 + l4*cos(theta_3)),2)*pow(cos(theta_1),2)*pow(cos(theta_2),2) + m_ul*pow((l4_CoM*cos(theta_3) + l3),2)*pow(sin(theta_1),2)*pow(cos(theta_2),2) + m_ul*pow((l4_CoM*cos(theta_3) + l3),2)*pow(sin(theta_2),2) + m_ul*pow((l4_CoM*cos(theta_3) + l3),2)*pow(cos(theta_1),2)*pow(cos(theta_2),2) + (Ixx_hip1*sin(theta_1) + Iyx_hip1*cos(theta_1))*sin(theta_1) + (Ixy_hip1*sin(theta_1) + Iyy_hip1*cos(theta_1))*cos(theta_1) + (-(sin(theta_1)*sin(theta_2)*sin(theta_3) + cos(theta_1)*cos(theta_3))*sin(theta_4) + (sin(theta_1)*sin(theta_2)*cos(theta_3) - sin(theta_3)*cos(theta_1))*cos(theta_4))*(Ixz_foot*sin(theta_1)*cos(theta_2) + Iyz_foot*((sin(theta_1)*sin(theta_2)*sin(theta_3) + cos(theta_1)*cos(theta_3))*cos(theta_4) + (sin(theta_1)*sin(theta_2)*cos(theta_3) - sin(theta_3)*cos(theta_1))*sin(theta_4)) + Izz_foot*(-(sin(theta_1)*sin(theta_2)*sin(theta_3) + cos(theta_1)*cos(theta_3))*sin(theta_4) + (sin(theta_1)*sin(theta_2)*cos(theta_3) - sin(theta_3)*cos(theta_1))*cos(theta_4))) + ((sin(theta_1)*sin(theta_2)*sin(theta_3) + cos(theta_1)*cos(theta_3))*cos(theta_4) + (sin(theta_1)*sin(theta_2)*cos(theta_3) - sin(theta_3)*cos(theta_1))*sin(theta_4))*(Ixy_foot*sin(theta_1)*cos(theta_2) + Iyy_foot*((sin(theta_1)*sin(theta_2)*sin(theta_3) + cos(theta_1)*cos(theta_3))*cos(theta_4) + (sin(theta_1)*sin(theta_2)*cos(theta_3) - sin(theta_3)*cos(theta_1))*sin(theta_4)) + Izy_foot*(-(sin(theta_1)*sin(theta_2)*sin(theta_3) + cos(theta_1)*cos(theta_3))*sin(theta_4) + (sin(theta_1)*sin(theta_2)*cos(theta_3) - sin(theta_3)*cos(theta_1))*cos(theta_4))) + (sin(theta_1)*sin(theta_2)*sin(theta_3) + cos(theta_1)*cos(theta_3))*(Ixy_ll*sin(theta_1)*cos(theta_2) + Iyy_ll*(sin(theta_1)*sin(theta_2)*sin(theta_3) + cos(theta_1)*cos(theta_3)) + Izy_ll*(sin(theta_1)*sin(theta_2)*cos(theta_3) - sin(theta_3)*cos(theta_1))) + (sin(theta_1)*sin(theta_2)*cos(theta_3) - sin(theta_3)*cos(theta_1))*(Ixz_ll*sin(theta_1)*cos(theta_2) + Iyz_ll*(sin(theta_1)*sin(theta_2)*sin(theta_3) + cos(theta_1)*cos(theta_3)) + Izz_ll*(sin(theta_1)*sin(theta_2)*cos(theta_3) - sin(theta_3)*cos(theta_1))) + (Ixx_foot*sin(theta_1)*cos(theta_2) + Iyx_foot*((sin(theta_1)*sin(theta_2)*sin(theta_3) + cos(theta_1)*cos(theta_3))*cos(theta_4) + (sin(theta_1)*sin(theta_2)*cos(theta_3) - sin(theta_3)*cos(theta_1))*sin(theta_4)) + Izx_foot*(-(sin(theta_1)*sin(theta_2)*sin(theta_3) + cos(theta_1)*cos(theta_3))*sin(theta_4) + (sin(theta_1)*sin(theta_2)*cos(theta_3) - sin(theta_3)*cos(theta_1))*cos(theta_4)))*sin(theta_1)*cos(theta_2) + (Ixx_ll*sin(theta_1)*cos(theta_2) + Iyx_ll*(sin(theta_1)*sin(theta_2)*sin(theta_3) + cos(theta_1)*cos(theta_3)) + Izx_ll*(sin(theta_1)*sin(theta_2)*cos(theta_3) - sin(theta_3)*cos(theta_1)))*sin(theta_1)*cos(theta_2) + (Ixx_ul*sin(theta_1)*cos(theta_2) + Iyx_ul*cos(theta_1) + Izx_ul*sin(theta_1)*sin(theta_2))*sin(theta_1)*cos(theta_2) + (Ixy_ul*sin(theta_1)*cos(theta_2) + Iyy_ul*cos(theta_1) + Izy_ul*sin(theta_1)*sin(theta_2))*cos(theta_1) + (Ixz_ul*sin(theta_1)*cos(theta_2) + Iyz_ul*cos(theta_1) + Izz_ul*sin(theta_1)*sin(theta_2))*sin(theta_1)*sin(theta_2);
    double B_8 = -l4_CoM*m_ul*(l4_CoM*cos(theta_3) + l3)*(-sin(theta_1)*cos(theta_3) + sin(theta_2)*sin(theta_3)*cos(theta_1))*cos(theta_1)*cos(theta_2) - l4_CoM*m_ul*(l4_CoM*cos(theta_3) + l3)*(sin(theta_1)*sin(theta_2)*sin(theta_3) + cos(theta_1)*cos(theta_3))*sin(theta_1)*cos(theta_2) + l4_CoM*m_ul*(l4_CoM*cos(theta_3) + l3)*sin(theta_2)*sin(theta_3)*cos(theta_2) - m_foot*(l6_CoM*(sin(theta_3 + theta_4 + theta_5)*sin(theta_1)*sin(theta_2) + cos(theta_3 + theta_4 + theta_5)*cos(theta_1)) + l4*(sin(theta_1)*sin(theta_2)*sin(theta_3) + cos(theta_1)*cos(theta_3)) + l5*(sin(theta_3 + theta_4)*sin(theta_1)*sin(theta_2) + cos(theta_3 + theta_4)*cos(theta_1)))*(l6_CoM*cos(theta_3 + theta_4 + theta_5) + l3 + l4*cos(theta_3) + l5*cos(theta_3 + theta_4))*sin(theta_1)*cos(theta_2) + m_foot*(l6_CoM*sin(theta_3 + theta_4 + theta_5) + l4*sin(theta_3) + l5*sin(theta_3 + theta_4))*(l6_CoM*cos(theta_3 + theta_4 + theta_5) + l3 + l4*cos(theta_3) + l5*cos(theta_3 + theta_4))*sin(theta_2)*cos(theta_2) - m_foot*(l6_CoM*cos(theta_3 + theta_4 + theta_5) + l3 + l4*cos(theta_3) + l5*cos(theta_3 + theta_4))*(l6_CoM*sin(theta_3 + theta_4 + theta_5)*sin(theta_2)*cos(theta_1) - l6_CoM*sin(theta_1)*cos(theta_3 + theta_4 + theta_5) - l4*sin(theta_1)*cos(theta_3) + l4*sin(theta_2)*sin(theta_3)*cos(theta_1) + l5*sin(theta_3 + theta_4)*sin(theta_2)*cos(theta_1) - l5*sin(theta_1)*cos(theta_3 + theta_4))*cos(theta_1)*cos(theta_2) - m_ll*(l5_CoM*(sin(theta_3 + theta_4)*sin(theta_1)*sin(theta_2) + cos(theta_3 + theta_4)*cos(theta_1)) + l4*(sin(theta_1)*sin(theta_2)*sin(theta_3) + cos(theta_1)*cos(theta_3)))*(l5_CoM*cos(theta_3 + theta_4) + l3 + l4*cos(theta_3))*sin(theta_1)*cos(theta_2) + m_ll*(l5_CoM*sin(theta_3 + theta_4) + l4*sin(theta_3))*(l5_CoM*cos(theta_3 + theta_4) + l3 + l4*cos(theta_3))*sin(theta_2)*cos(theta_2) - m_ll*(l5_CoM*cos(theta_3 + theta_4) + l3 + l4*cos(theta_3))*(l5_CoM*sin(theta_3 + theta_4)*sin(theta_2)*cos(theta_1) - l5_CoM*sin(theta_1)*cos(theta_3 + theta_4) - l4*sin(theta_1)*cos(theta_3) + l4*sin(theta_2)*sin(theta_3)*cos(theta_1))*cos(theta_1)*cos(theta_2) + ((sin(theta_1)*sin(theta_3) + sin(theta_2)*cos(theta_1)*cos(theta_3))*sin(theta_4) + (-sin(theta_1)*cos(theta_3) + sin(theta_2)*sin(theta_3)*cos(theta_1))*cos(theta_4))*(Ixy_foot*sin(theta_1)*cos(theta_2) + Iyy_foot*((sin(theta_1)*sin(theta_2)*sin(theta_3) + cos(theta_1)*cos(theta_3))*cos(theta_4) + (sin(theta_1)*sin(theta_2)*cos(theta_3) - sin(theta_3)*cos(theta_1))*sin(theta_4)) + Izy_foot*(-(sin(theta_1)*sin(theta_2)*sin(theta_3) + cos(theta_1)*cos(theta_3))*sin(theta_4) + (sin(theta_1)*sin(theta_2)*cos(theta_3) - sin(theta_3)*cos(theta_1))*cos(theta_4))) + ((sin(theta_1)*sin(theta_3) + sin(theta_2)*cos(theta_1)*cos(theta_3))*cos(theta_4) - (-sin(theta_1)*cos(theta_3) + sin(theta_2)*sin(theta_3)*cos(theta_1))*sin(theta_4))*(Ixz_foot*sin(theta_1)*cos(theta_2) + Iyz_foot*((sin(theta_1)*sin(theta_2)*sin(theta_3) + cos(theta_1)*cos(theta_3))*cos(theta_4) + (sin(theta_1)*sin(theta_2)*cos(theta_3) - sin(theta_3)*cos(theta_1))*sin(theta_4)) + Izz_foot*(-(sin(theta_1)*sin(theta_2)*sin(theta_3) + cos(theta_1)*cos(theta_3))*sin(theta_4) + (sin(theta_1)*sin(theta_2)*cos(theta_3) - sin(theta_3)*cos(theta_1))*cos(theta_4))) + (sin(theta_1)*sin(theta_3) + sin(theta_2)*cos(theta_1)*cos(theta_3))*(Ixz_ll*sin(theta_1)*cos(theta_2) + Iyz_ll*(sin(theta_1)*sin(theta_2)*sin(theta_3) + cos(theta_1)*cos(theta_3)) + Izz_ll*(sin(theta_1)*sin(theta_2)*cos(theta_3) - sin(theta_3)*cos(theta_1))) + (-sin(theta_1)*cos(theta_3) + sin(theta_2)*sin(theta_3)*cos(theta_1))*(Ixy_ll*sin(theta_1)*cos(theta_2) + Iyy_ll*(sin(theta_1)*sin(theta_2)*sin(theta_3) + cos(theta_1)*cos(theta_3)) + Izy_ll*(sin(theta_1)*sin(theta_2)*cos(theta_3) - sin(theta_3)*cos(theta_1))) + (Ixx_foot*sin(theta_1)*cos(theta_2) + Iyx_foot*((sin(theta_1)*sin(theta_2)*sin(theta_3) + cos(theta_1)*cos(theta_3))*cos(theta_4) + (sin(theta_1)*sin(theta_2)*cos(theta_3) - sin(theta_3)*cos(theta_1))*sin(theta_4)) + Izx_foot*(-(sin(theta_1)*sin(theta_2)*sin(theta_3) + cos(theta_1)*cos(theta_3))*sin(theta_4) + (sin(theta_1)*sin(theta_2)*cos(theta_3) - sin(theta_3)*cos(theta_1))*cos(theta_4)))*cos(theta_1)*cos(theta_2) + (Ixx_ll*sin(theta_1)*cos(theta_2) + Iyx_ll*(sin(theta_1)*sin(theta_2)*sin(theta_3) + cos(theta_1)*cos(theta_3)) + Izx_ll*(sin(theta_1)*sin(theta_2)*cos(theta_3) - sin(theta_3)*cos(theta_1)))*cos(theta_1)*cos(theta_2) + (Ixx_ul*sin(theta_1)*cos(theta_2) + Iyx_ul*cos(theta_1) + Izx_ul*sin(theta_1)*sin(theta_2))*cos(theta_1)*cos(theta_2) - (Ixy_ul*sin(theta_1)*cos(theta_2) + Iyy_ul*cos(theta_1) + Izy_ul*sin(theta_1)*sin(theta_2))*sin(theta_1) + (Ixz_ul*sin(theta_1)*cos(theta_2) + Iyz_ul*cos(theta_1) + Izz_ul*sin(theta_1)*sin(theta_2))*sin(theta_2)*cos(theta_1);
    double B_9 = -l5_CoM*m_ll*(sin(theta_3 + theta_4)*sin(theta_1)*sin(theta_2) + cos(theta_3 + theta_4)*cos(theta_1))*(l5_CoM*cos(theta_3 + theta_4) + l3 + l4*cos(theta_3))*sin(theta_1)*cos(theta_2) - l5_CoM*m_ll*(sin(theta_3 + theta_4)*sin(theta_2)*cos(theta_1) - sin(theta_1)*cos(theta_3 + theta_4))*(l5_CoM*cos(theta_3 + theta_4) + l3 + l4*cos(theta_3))*cos(theta_1)*cos(theta_2) + l5_CoM*m_ll*(l5_CoM*cos(theta_3 + theta_4) + l3 + l4*cos(theta_3))*sin(theta_3 + theta_4)*sin(theta_2)*cos(theta_2) - m_foot*(l6_CoM*(sin(theta_3 + theta_4 + theta_5)*sin(theta_1)*sin(theta_2) + cos(theta_3 + theta_4 + theta_5)*cos(theta_1)) + l5*(sin(theta_3 + theta_4)*sin(theta_1)*sin(theta_2) + cos(theta_3 + theta_4)*cos(theta_1)))*(l6_CoM*cos(theta_3 + theta_4 + theta_5) + l3 + l4*cos(theta_3) + l5*cos(theta_3 + theta_4))*sin(theta_1)*cos(theta_2) + m_foot*(l6_CoM*sin(theta_3 + theta_4 + theta_5) + l5*sin(theta_3 + theta_4))*(l6_CoM*cos(theta_3 + theta_4 + theta_5) + l3 + l4*cos(theta_3) + l5*cos(theta_3 + theta_4))*sin(theta_2)*cos(theta_2) - m_foot*(l6_CoM*cos(theta_3 + theta_4 + theta_5) + l3 + l4*cos(theta_3) + l5*cos(theta_3 + theta_4))*(l6_CoM*sin(theta_3 + theta_4 + theta_5)*sin(theta_2)*cos(theta_1) - l6_CoM*sin(theta_1)*cos(theta_3 + theta_4 + theta_5) + l5*sin(theta_3 + theta_4)*sin(theta_2)*cos(theta_1) - l5*sin(theta_1)*cos(theta_3 + theta_4))*cos(theta_1)*cos(theta_2) + ((sin(theta_1)*sin(theta_3) + sin(theta_2)*cos(theta_1)*cos(theta_3))*sin(theta_4) + (-sin(theta_1)*cos(theta_3) + sin(theta_2)*sin(theta_3)*cos(theta_1))*cos(theta_4))*(Ixy_foot*sin(theta_1)*cos(theta_2) + Iyy_foot*((sin(theta_1)*sin(theta_2)*sin(theta_3) + cos(theta_1)*cos(theta_3))*cos(theta_4) + (sin(theta_1)*sin(theta_2)*cos(theta_3) - sin(theta_3)*cos(theta_1))*sin(theta_4)) + Izy_foot*(-(sin(theta_1)*sin(theta_2)*sin(theta_3) + cos(theta_1)*cos(theta_3))*sin(theta_4) + (sin(theta_1)*sin(theta_2)*cos(theta_3) - sin(theta_3)*cos(theta_1))*cos(theta_4))) + ((sin(theta_1)*sin(theta_3) + sin(theta_2)*cos(theta_1)*cos(theta_3))*cos(theta_4) - (-sin(theta_1)*cos(theta_3) + sin(theta_2)*sin(theta_3)*cos(theta_1))*sin(theta_4))*(Ixz_foot*sin(theta_1)*cos(theta_2) + Iyz_foot*((sin(theta_1)*sin(theta_2)*sin(theta_3) + cos(theta_1)*cos(theta_3))*cos(theta_4) + (sin(theta_1)*sin(theta_2)*cos(theta_3) - sin(theta_3)*cos(theta_1))*sin(theta_4)) + Izz_foot*(-(sin(theta_1)*sin(theta_2)*sin(theta_3) + cos(theta_1)*cos(theta_3))*sin(theta_4) + (sin(theta_1)*sin(theta_2)*cos(theta_3) - sin(theta_3)*cos(theta_1))*cos(theta_4))) + (sin(theta_1)*sin(theta_3) + sin(theta_2)*cos(theta_1)*cos(theta_3))*(Ixz_ll*sin(theta_1)*cos(theta_2) + Iyz_ll*(sin(theta_1)*sin(theta_2)*sin(theta_3) + cos(theta_1)*cos(theta_3)) + Izz_ll*(sin(theta_1)*sin(theta_2)*cos(theta_3) - sin(theta_3)*cos(theta_1))) + (-sin(theta_1)*cos(theta_3) + sin(theta_2)*sin(theta_3)*cos(theta_1))*(Ixy_ll*sin(theta_1)*cos(theta_2) + Iyy_ll*(sin(theta_1)*sin(theta_2)*sin(theta_3) + cos(theta_1)*cos(theta_3)) + Izy_ll*(sin(theta_1)*sin(theta_2)*cos(theta_3) - sin(theta_3)*cos(theta_1))) + (Ixx_foot*sin(theta_1)*cos(theta_2) + Iyx_foot*((sin(theta_1)*sin(theta_2)*sin(theta_3) + cos(theta_1)*cos(theta_3))*cos(theta_4) + (sin(theta_1)*sin(theta_2)*cos(theta_3) - sin(theta_3)*cos(theta_1))*sin(theta_4)) + Izx_foot*(-(sin(theta_1)*sin(theta_2)*sin(theta_3) + cos(theta_1)*cos(theta_3))*sin(theta_4) + (sin(theta_1)*sin(theta_2)*cos(theta_3) - sin(theta_3)*cos(theta_1))*cos(theta_4)))*cos(theta_1)*cos(theta_2) + (Ixx_ll*sin(theta_1)*cos(theta_2) + Iyx_ll*(sin(theta_1)*sin(theta_2)*sin(theta_3) + cos(theta_1)*cos(theta_3)) + Izx_ll*(sin(theta_1)*sin(theta_2)*cos(theta_3) - sin(theta_3)*cos(theta_1)))*cos(theta_1)*cos(theta_2);
    double B_10 = -l6_CoM*m_foot*(sin(theta_3 + theta_4 + theta_5)*sin(theta_1)*sin(theta_2) + cos(theta_3 + theta_4 + theta_5)*cos(theta_1))*(l6_CoM*cos(theta_3 + theta_4 + theta_5) + l3 + l4*cos(theta_3) + l5*cos(theta_3 + theta_4))*sin(theta_1)*cos(theta_2) - l6_CoM*m_foot*(sin(theta_3 + theta_4 + theta_5)*sin(theta_2)*cos(theta_1) - sin(theta_1)*cos(theta_3 + theta_4 + theta_5))*(l6_CoM*cos(theta_3 + theta_4 + theta_5) + l3 + l4*cos(theta_3) + l5*cos(theta_3 + theta_4))*cos(theta_1)*cos(theta_2) + l6_CoM*m_foot*(l6_CoM*cos(theta_3 + theta_4 + theta_5) + l3 + l4*cos(theta_3) + l5*cos(theta_3 + theta_4))*sin(theta_3 + theta_4 + theta_5)*sin(theta_2)*cos(theta_2) + ((sin(theta_1)*sin(theta_3) + sin(theta_2)*cos(theta_1)*cos(theta_3))*sin(theta_4) + (-sin(theta_1)*cos(theta_3) + sin(theta_2)*sin(theta_3)*cos(theta_1))*cos(theta_4))*(Ixy_foot*sin(theta_1)*cos(theta_2) + Iyy_foot*((sin(theta_1)*sin(theta_2)*sin(theta_3) + cos(theta_1)*cos(theta_3))*cos(theta_4) + (sin(theta_1)*sin(theta_2)*cos(theta_3) - sin(theta_3)*cos(theta_1))*sin(theta_4)) + Izy_foot*(-(sin(theta_1)*sin(theta_2)*sin(theta_3) + cos(theta_1)*cos(theta_3))*sin(theta_4) + (sin(theta_1)*sin(theta_2)*cos(theta_3) - sin(theta_3)*cos(theta_1))*cos(theta_4))) + ((sin(theta_1)*sin(theta_3) + sin(theta_2)*cos(theta_1)*cos(theta_3))*cos(theta_4) - (-sin(theta_1)*cos(theta_3) + sin(theta_2)*sin(theta_3)*cos(theta_1))*sin(theta_4))*(Ixz_foot*sin(theta_1)*cos(theta_2) + Iyz_foot*((sin(theta_1)*sin(theta_2)*sin(theta_3) + cos(theta_1)*cos(theta_3))*cos(theta_4) + (sin(theta_1)*sin(theta_2)*cos(theta_3) - sin(theta_3)*cos(theta_1))*sin(theta_4)) + Izz_foot*(-(sin(theta_1)*sin(theta_2)*sin(theta_3) + cos(theta_1)*cos(theta_3))*sin(theta_4) + (sin(theta_1)*sin(theta_2)*cos(theta_3) - sin(theta_3)*cos(theta_1))*cos(theta_4))) + (Ixx_foot*sin(theta_1)*cos(theta_2) + Iyx_foot*((sin(theta_1)*sin(theta_2)*sin(theta_3) + cos(theta_1)*cos(theta_3))*cos(theta_4) + (sin(theta_1)*sin(theta_2)*cos(theta_3) - sin(theta_3)*cos(theta_1))*sin(theta_4)) + Izx_foot*(-(sin(theta_1)*sin(theta_2)*sin(theta_3) + cos(theta_1)*cos(theta_3))*sin(theta_4) + (sin(theta_1)*sin(theta_2)*cos(theta_3) - sin(theta_3)*cos(theta_1))*cos(theta_4)))*cos(theta_1)*cos(theta_2);
    double B_11 = l4_CoM*m_ul*(-sin(theta_1)*cos(theta_3) + sin(theta_2)*sin(theta_3)*cos(theta_1))*(l4_CoM*sin(theta_1)*sin(theta_2)*cos(theta_3) - l4_CoM*sin(theta_3)*cos(theta_1) + l3*sin(theta_1)*sin(theta_2)) + l4_CoM*m_ul*(sin(theta_1)*sin(theta_2)*sin(theta_3) + cos(theta_1)*cos(theta_3))*(-l4_CoM*sin(theta_1)*sin(theta_3) - l4_CoM*sin(theta_2)*cos(theta_1)*cos(theta_3) - l3*sin(theta_2)*cos(theta_1)) + m_foot*(l6_CoM*(sin(theta_3 + theta_4 + theta_5)*sin(theta_1)*sin(theta_2) + cos(theta_3 + theta_4 + theta_5)*cos(theta_1)) + l4*(sin(theta_1)*sin(theta_2)*sin(theta_3) + cos(theta_1)*cos(theta_3)) + l5*(sin(theta_3 + theta_4)*sin(theta_1)*sin(theta_2) + cos(theta_3 + theta_4)*cos(theta_1)))*(-l6_CoM*sin(theta_3 + theta_4 + theta_5)*sin(theta_1) - l6_CoM*sin(theta_2)*cos(theta_3 + theta_4 + theta_5)*cos(theta_1) - l3*sin(theta_2)*cos(theta_1) - l4*sin(theta_1)*sin(theta_3) - l4*sin(theta_2)*cos(theta_1)*cos(theta_3) - l5*sin(theta_3 + theta_4)*sin(theta_1) - l5*sin(theta_2)*cos(theta_3 + theta_4)*cos(theta_1)) + m_foot*(l6_CoM*sin(theta_3 + theta_4 + theta_5)*sin(theta_2)*cos(theta_1) - l6_CoM*sin(theta_1)*cos(theta_3 + theta_4 + theta_5) - l4*sin(theta_1)*cos(theta_3) + l4*sin(theta_2)*sin(theta_3)*cos(theta_1) + l5*sin(theta_3 + theta_4)*sin(theta_2)*cos(theta_1) - l5*sin(theta_1)*cos(theta_3 + theta_4))*(-l6_CoM*sin(theta_3 + theta_4 + theta_5)*cos(theta_1) + l6_CoM*sin(theta_1)*sin(theta_2)*cos(theta_3 + theta_4 + theta_5) + l3*sin(theta_1)*sin(theta_2) + l4*sin(theta_1)*sin(theta_2)*cos(theta_3) - l4*sin(theta_3)*cos(theta_1) - l5*sin(theta_3 + theta_4)*cos(theta_1) + l5*sin(theta_1)*sin(theta_2)*cos(theta_3 + theta_4)) + m_ll*(l5_CoM*(sin(theta_3 + theta_4)*sin(theta_1)*sin(theta_2) + cos(theta_3 + theta_4)*cos(theta_1)) + l4*(sin(theta_1)*sin(theta_2)*sin(theta_3) + cos(theta_1)*cos(theta_3)))*(-l5_CoM*sin(theta_3 + theta_4)*sin(theta_1) - l5_CoM*sin(theta_2)*cos(theta_3 + theta_4)*cos(theta_1) - l3*sin(theta_2)*cos(theta_1) - l4*sin(theta_1)*sin(theta_3) - l4*sin(theta_2)*cos(theta_1)*cos(theta_3)) + m_ll*(l5_CoM*sin(theta_3 + theta_4)*sin(theta_2)*cos(theta_1) - l5_CoM*sin(theta_1)*cos(theta_3 + theta_4) - l4*sin(theta_1)*cos(theta_3) + l4*sin(theta_2)*sin(theta_3)*cos(theta_1))*(-l5_CoM*sin(theta_3 + theta_4)*cos(theta_1) + l5_CoM*sin(theta_1)*sin(theta_2)*cos(theta_3 + theta_4) + l3*sin(theta_1)*sin(theta_2) + l4*sin(theta_1)*sin(theta_2)*cos(theta_3) - l4*sin(theta_3)*cos(theta_1)) + (-sin(theta_3)*sin(theta_4)*cos(theta_2) + cos(theta_2)*cos(theta_3)*cos(theta_4))*(Ixz_foot*cos(theta_1)*cos(theta_2) + Iyz_foot*((sin(theta_1)*sin(theta_3) + sin(theta_2)*cos(theta_1)*cos(theta_3))*sin(theta_4) + (-sin(theta_1)*cos(theta_3) + sin(theta_2)*sin(theta_3)*cos(theta_1))*cos(theta_4)) + Izz_foot*((sin(theta_1)*sin(theta_3) + sin(theta_2)*cos(theta_1)*cos(theta_3))*cos(theta_4) - (-sin(theta_1)*cos(theta_3) + sin(theta_2)*sin(theta_3)*cos(theta_1))*sin(theta_4))) + (sin(theta_3)*cos(theta_2)*cos(theta_4) + sin(theta_4)*cos(theta_2)*cos(theta_3))*(Ixy_foot*cos(theta_1)*cos(theta_2) + Iyy_foot*((sin(theta_1)*sin(theta_3) + sin(theta_2)*cos(theta_1)*cos(theta_3))*sin(theta_4) + (-sin(theta_1)*cos(theta_3) + sin(theta_2)*sin(theta_3)*cos(theta_1))*cos(theta_4)) + Izy_foot*((sin(theta_1)*sin(theta_3) + sin(theta_2)*cos(theta_1)*cos(theta_3))*cos(theta_4) - (-sin(theta_1)*cos(theta_3) + sin(theta_2)*sin(theta_3)*cos(theta_1))*sin(theta_4))) - (Ixx_foot*cos(theta_1)*cos(theta_2) + Iyx_foot*((sin(theta_1)*sin(theta_3) + sin(theta_2)*cos(theta_1)*cos(theta_3))*sin(theta_4) + (-sin(theta_1)*cos(theta_3) + sin(theta_2)*sin(theta_3)*cos(theta_1))*cos(theta_4)) + Izx_foot*((sin(theta_1)*sin(theta_3) + sin(theta_2)*cos(theta_1)*cos(theta_3))*cos(theta_4) - (-sin(theta_1)*cos(theta_3) + sin(theta_2)*sin(theta_3)*cos(theta_1))*sin(theta_4)))*sin(theta_2) - (Ixx_ll*cos(theta_1)*cos(theta_2) + Iyx_ll*(-sin(theta_1)*cos(theta_3) + sin(theta_2)*sin(theta_3)*cos(theta_1)) + Izx_ll*(sin(theta_1)*sin(theta_3) + sin(theta_2)*cos(theta_1)*cos(theta_3)))*sin(theta_2) - (Ixx_ul*cos(theta_1)*cos(theta_2) - Iyx_ul*sin(theta_1) + Izx_ul*sin(theta_2)*cos(theta_1))*sin(theta_2) + (Ixy_ll*cos(theta_1)*cos(theta_2) + Iyy_ll*(-sin(theta_1)*cos(theta_3) + sin(theta_2)*sin(theta_3)*cos(theta_1)) + Izy_ll*(sin(theta_1)*sin(theta_3) + sin(theta_2)*cos(theta_1)*cos(theta_3)))*sin(theta_3)*cos(theta_2) + (Ixz_ll*cos(theta_1)*cos(theta_2) + Iyz_ll*(-sin(theta_1)*cos(theta_3) + sin(theta_2)*sin(theta_3)*cos(theta_1)) + Izz_ll*(sin(theta_1)*sin(theta_3) + sin(theta_2)*cos(theta_1)*cos(theta_3)))*cos(theta_2)*cos(theta_3) + (Ixz_ul*cos(theta_1)*cos(theta_2) - Iyz_ul*sin(theta_1) + Izz_ul*sin(theta_2)*cos(theta_1))*cos(theta_2);
    double B_12 = -l4_CoM*m_ul*(l4_CoM*cos(theta_3) + l3)*(-sin(theta_1)*cos(theta_3) + sin(theta_2)*sin(theta_3)*cos(theta_1))*cos(theta_1)*cos(theta_2) - l4_CoM*m_ul*(l4_CoM*cos(theta_3) + l3)*(sin(theta_1)*sin(theta_2)*sin(theta_3) + cos(theta_1)*cos(theta_3))*sin(theta_1)*cos(theta_2) + l4_CoM*m_ul*(l4_CoM*cos(theta_3) + l3)*sin(theta_2)*sin(theta_3)*cos(theta_2) - m_foot*(l6_CoM*(sin(theta_3 + theta_4 + theta_5)*sin(theta_1)*sin(theta_2) + cos(theta_3 + theta_4 + theta_5)*cos(theta_1)) + l4*(sin(theta_1)*sin(theta_2)*sin(theta_3) + cos(theta_1)*cos(theta_3)) + l5*(sin(theta_3 + theta_4)*sin(theta_1)*sin(theta_2) + cos(theta_3 + theta_4)*cos(theta_1)))*(l6_CoM*cos(theta_3 + theta_4 + theta_5) + l3 + l4*cos(theta_3) + l5*cos(theta_3 + theta_4))*sin(theta_1)*cos(theta_2) + m_foot*(l6_CoM*sin(theta_3 + theta_4 + theta_5) + l4*sin(theta_3) + l5*sin(theta_3 + theta_4))*(l6_CoM*cos(theta_3 + theta_4 + theta_5) + l3 + l4*cos(theta_3) + l5*cos(theta_3 + theta_4))*sin(theta_2)*cos(theta_2) - m_foot*(l6_CoM*cos(theta_3 + theta_4 + theta_5) + l3 + l4*cos(theta_3) + l5*cos(theta_3 + theta_4))*(l6_CoM*sin(theta_3 + theta_4 + theta_5)*sin(theta_2)*cos(theta_1) - l6_CoM*sin(theta_1)*cos(theta_3 + theta_4 + theta_5) - l4*sin(theta_1)*cos(theta_3) + l4*sin(theta_2)*sin(theta_3)*cos(theta_1) + l5*sin(theta_3 + theta_4)*sin(theta_2)*cos(theta_1) - l5*sin(theta_1)*cos(theta_3 + theta_4))*cos(theta_1)*cos(theta_2) - m_ll*(l5_CoM*(sin(theta_3 + theta_4)*sin(theta_1)*sin(theta_2) + cos(theta_3 + theta_4)*cos(theta_1)) + l4*(sin(theta_1)*sin(theta_2)*sin(theta_3) + cos(theta_1)*cos(theta_3)))*(l5_CoM*cos(theta_3 + theta_4) + l3 + l4*cos(theta_3))*sin(theta_1)*cos(theta_2) + m_ll*(l5_CoM*sin(theta_3 + theta_4) + l4*sin(theta_3))*(l5_CoM*cos(theta_3 + theta_4) + l3 + l4*cos(theta_3))*sin(theta_2)*cos(theta_2) - m_ll*(l5_CoM*cos(theta_3 + theta_4) + l3 + l4*cos(theta_3))*(l5_CoM*sin(theta_3 + theta_4)*sin(theta_2)*cos(theta_1) - l5_CoM*sin(theta_1)*cos(theta_3 + theta_4) - l4*sin(theta_1)*cos(theta_3) + l4*sin(theta_2)*sin(theta_3)*cos(theta_1))*cos(theta_1)*cos(theta_2) + (-(sin(theta_1)*sin(theta_2)*sin(theta_3) + cos(theta_1)*cos(theta_3))*sin(theta_4) + (sin(theta_1)*sin(theta_2)*cos(theta_3) - sin(theta_3)*cos(theta_1))*cos(theta_4))*(Ixz_foot*cos(theta_1)*cos(theta_2) + Iyz_foot*((sin(theta_1)*sin(theta_3) + sin(theta_2)*cos(theta_1)*cos(theta_3))*sin(theta_4) + (-sin(theta_1)*cos(theta_3) + sin(theta_2)*sin(theta_3)*cos(theta_1))*cos(theta_4)) + Izz_foot*((sin(theta_1)*sin(theta_3) + sin(theta_2)*cos(theta_1)*cos(theta_3))*cos(theta_4) - (-sin(theta_1)*cos(theta_3) + sin(theta_2)*sin(theta_3)*cos(theta_1))*sin(theta_4))) + ((sin(theta_1)*sin(theta_2)*sin(theta_3) + cos(theta_1)*cos(theta_3))*cos(theta_4) + (sin(theta_1)*sin(theta_2)*cos(theta_3) - sin(theta_3)*cos(theta_1))*sin(theta_4))*(Ixy_foot*cos(theta_1)*cos(theta_2) + Iyy_foot*((sin(theta_1)*sin(theta_3) + sin(theta_2)*cos(theta_1)*cos(theta_3))*sin(theta_4) + (-sin(theta_1)*cos(theta_3) + sin(theta_2)*sin(theta_3)*cos(theta_1))*cos(theta_4)) + Izy_foot*((sin(theta_1)*sin(theta_3) + sin(theta_2)*cos(theta_1)*cos(theta_3))*cos(theta_4) - (-sin(theta_1)*cos(theta_3) + sin(theta_2)*sin(theta_3)*cos(theta_1))*sin(theta_4))) + (sin(theta_1)*sin(theta_2)*sin(theta_3) + cos(theta_1)*cos(theta_3))*(Ixy_ll*cos(theta_1)*cos(theta_2) + Iyy_ll*(-sin(theta_1)*cos(theta_3) + sin(theta_2)*sin(theta_3)*cos(theta_1)) + Izy_ll*(sin(theta_1)*sin(theta_3) + sin(theta_2)*cos(theta_1)*cos(theta_3))) + (sin(theta_1)*sin(theta_2)*cos(theta_3) - sin(theta_3)*cos(theta_1))*(Ixz_ll*cos(theta_1)*cos(theta_2) + Iyz_ll*(-sin(theta_1)*cos(theta_3) + sin(theta_2)*sin(theta_3)*cos(theta_1)) + Izz_ll*(sin(theta_1)*sin(theta_3) + sin(theta_2)*cos(theta_1)*cos(theta_3))) + (Ixx_foot*cos(theta_1)*cos(theta_2) + Iyx_foot*((sin(theta_1)*sin(theta_3) + sin(theta_2)*cos(theta_1)*cos(theta_3))*sin(theta_4) + (-sin(theta_1)*cos(theta_3) + sin(theta_2)*sin(theta_3)*cos(theta_1))*cos(theta_4)) + Izx_foot*((sin(theta_1)*sin(theta_3) + sin(theta_2)*cos(theta_1)*cos(theta_3))*cos(theta_4) - (-sin(theta_1)*cos(theta_3) + sin(theta_2)*sin(theta_3)*cos(theta_1))*sin(theta_4)))*sin(theta_1)*cos(theta_2) + (Ixx_ll*cos(theta_1)*cos(theta_2) + Iyx_ll*(-sin(theta_1)*cos(theta_3) + sin(theta_2)*sin(theta_3)*cos(theta_1)) + Izx_ll*(sin(theta_1)*sin(theta_3) + sin(theta_2)*cos(theta_1)*cos(theta_3)))*sin(theta_1)*cos(theta_2) + (Ixx_ul*cos(theta_1)*cos(theta_2) - Iyx_ul*sin(theta_1) + Izx_ul*sin(theta_2)*cos(theta_1))*sin(theta_1)*cos(theta_2) + (Ixy_ul*cos(theta_1)*cos(theta_2) - Iyy_ul*sin(theta_1) + Izy_ul*sin(theta_2)*cos(theta_1))*cos(theta_1) + (Ixz_ul*cos(theta_1)*cos(theta_2) - Iyz_ul*sin(theta_1) + Izz_ul*sin(theta_2)*cos(theta_1))*sin(theta_1)*sin(theta_2);
    double B_13 = pow(l4_CoM,2)*m_ul*pow((-sin(theta_1)*cos(theta_3) + sin(theta_2)*sin(theta_3)*cos(theta_1)),2) + pow(l4_CoM,2)*m_ul*pow((sin(theta_1)*sin(theta_2)*sin(theta_3) + cos(theta_1)*cos(theta_3)),2) + pow(l4_CoM,2)*m_ul*pow(sin(theta_3),2)*pow(cos(theta_2),2) + m_foot*pow((l6_CoM*(sin(theta_3 + theta_4 + theta_5)*sin(theta_1)*sin(theta_2) + cos(theta_3 + theta_4 + theta_5)*cos(theta_1)) + l4*(sin(theta_1)*sin(theta_2)*sin(theta_3) + cos(theta_1)*cos(theta_3)) + l5*(sin(theta_3 + theta_4)*sin(theta_1)*sin(theta_2) + cos(theta_3 + theta_4)*cos(theta_1))),2) + m_foot*pow((l6_CoM*sin(theta_3 + theta_4 + theta_5) + l4*sin(theta_3) + l5*sin(theta_3 + theta_4)),2)*pow(cos(theta_2),2) + m_foot*pow((l6_CoM*sin(theta_3 + theta_4 + theta_5)*sin(theta_2)*cos(theta_1) - l6_CoM*sin(theta_1)*cos(theta_3 + theta_4 + theta_5) - l4*sin(theta_1)*cos(theta_3) + l4*sin(theta_2)*sin(theta_3)*cos(theta_1) + l5*sin(theta_3 + theta_4)*sin(theta_2)*cos(theta_1) - l5*sin(theta_1)*cos(theta_3 + theta_4)),2) + m_ll*pow((l5_CoM*(sin(theta_3 + theta_4)*sin(theta_1)*sin(theta_2) + cos(theta_3 + theta_4)*cos(theta_1)) + l4*(sin(theta_1)*sin(theta_2)*sin(theta_3) + cos(theta_1)*cos(theta_3))),2) + m_ll*pow((l5_CoM*sin(theta_3 + theta_4) + l4*sin(theta_3)),2)*pow(cos(theta_2),2) + m_ll*pow((l5_CoM*sin(theta_3 + theta_4)*sin(theta_2)*cos(theta_1) - l5_CoM*sin(theta_1)*cos(theta_3 + theta_4) - l4*sin(theta_1)*cos(theta_3) + l4*sin(theta_2)*sin(theta_3)*cos(theta_1)),2) + ((sin(theta_1)*sin(theta_3) + sin(theta_2)*cos(theta_1)*cos(theta_3))*sin(theta_4) + (-sin(theta_1)*cos(theta_3) + sin(theta_2)*sin(theta_3)*cos(theta_1))*cos(theta_4))*(Ixy_foot*cos(theta_1)*cos(theta_2) + Iyy_foot*((sin(theta_1)*sin(theta_3) + sin(theta_2)*cos(theta_1)*cos(theta_3))*sin(theta_4) + (-sin(theta_1)*cos(theta_3) + sin(theta_2)*sin(theta_3)*cos(theta_1))*cos(theta_4)) + Izy_foot*((sin(theta_1)*sin(theta_3) + sin(theta_2)*cos(theta_1)*cos(theta_3))*cos(theta_4) - (-sin(theta_1)*cos(theta_3) + sin(theta_2)*sin(theta_3)*cos(theta_1))*sin(theta_4))) + ((sin(theta_1)*sin(theta_3) + sin(theta_2)*cos(theta_1)*cos(theta_3))*cos(theta_4) - (-sin(theta_1)*cos(theta_3) + sin(theta_2)*sin(theta_3)*cos(theta_1))*sin(theta_4))*(Ixz_foot*cos(theta_1)*cos(theta_2) + Iyz_foot*((sin(theta_1)*sin(theta_3) + sin(theta_2)*cos(theta_1)*cos(theta_3))*sin(theta_4) + (-sin(theta_1)*cos(theta_3) + sin(theta_2)*sin(theta_3)*cos(theta_1))*cos(theta_4)) + Izz_foot*((sin(theta_1)*sin(theta_3) + sin(theta_2)*cos(theta_1)*cos(theta_3))*cos(theta_4) - (-sin(theta_1)*cos(theta_3) + sin(theta_2)*sin(theta_3)*cos(theta_1))*sin(theta_4))) + (sin(theta_1)*sin(theta_3) + sin(theta_2)*cos(theta_1)*cos(theta_3))*(Ixz_ll*cos(theta_1)*cos(theta_2) + Iyz_ll*(-sin(theta_1)*cos(theta_3) + sin(theta_2)*sin(theta_3)*cos(theta_1)) + Izz_ll*(sin(theta_1)*sin(theta_3) + sin(theta_2)*cos(theta_1)*cos(theta_3))) + (-sin(theta_1)*cos(theta_3) + sin(theta_2)*sin(theta_3)*cos(theta_1))*(Ixy_ll*cos(theta_1)*cos(theta_2) + Iyy_ll*(-sin(theta_1)*cos(theta_3) + sin(theta_2)*sin(theta_3)*cos(theta_1)) + Izy_ll*(sin(theta_1)*sin(theta_3) + sin(theta_2)*cos(theta_1)*cos(theta_3))) + (Ixx_foot*cos(theta_1)*cos(theta_2) + Iyx_foot*((sin(theta_1)*sin(theta_3) + sin(theta_2)*cos(theta_1)*cos(theta_3))*sin(theta_4) + (-sin(theta_1)*cos(theta_3) + sin(theta_2)*sin(theta_3)*cos(theta_1))*cos(theta_4)) + Izx_foot*((sin(theta_1)*sin(theta_3) + sin(theta_2)*cos(theta_1)*cos(theta_3))*cos(theta_4) - (-sin(theta_1)*cos(theta_3) + sin(theta_2)*sin(theta_3)*cos(theta_1))*sin(theta_4)))*cos(theta_1)*cos(theta_2) + (Ixx_ll*cos(theta_1)*cos(theta_2) + Iyx_ll*(-sin(theta_1)*cos(theta_3) + sin(theta_2)*sin(theta_3)*cos(theta_1)) + Izx_ll*(sin(theta_1)*sin(theta_3) + sin(theta_2)*cos(theta_1)*cos(theta_3)))*cos(theta_1)*cos(theta_2) + (Ixx_ul*cos(theta_1)*cos(theta_2) - Iyx_ul*sin(theta_1) + Izx_ul*sin(theta_2)*cos(theta_1))*cos(theta_1)*cos(theta_2) - (Ixy_ul*cos(theta_1)*cos(theta_2) - Iyy_ul*sin(theta_1) + Izy_ul*sin(theta_2)*cos(theta_1))*sin(theta_1) + (Ixz_ul*cos(theta_1)*cos(theta_2) - Iyz_ul*sin(theta_1) + Izz_ul*sin(theta_2)*cos(theta_1))*sin(theta_2)*cos(theta_1);
    double B_14 = l5_CoM*m_ll*(l5_CoM*(sin(theta_3 + theta_4)*sin(theta_1)*sin(theta_2) + cos(theta_3 + theta_4)*cos(theta_1)) + l4*(sin(theta_1)*sin(theta_2)*sin(theta_3) + cos(theta_1)*cos(theta_3)))*(sin(theta_3 + theta_4)*sin(theta_1)*sin(theta_2) + cos(theta_3 + theta_4)*cos(theta_1)) + l5_CoM*m_ll*(l5_CoM*sin(theta_3 + theta_4) + l4*sin(theta_3))*sin(theta_3 + theta_4)*pow(cos(theta_2),2) + l5_CoM*m_ll*(sin(theta_3 + theta_4)*sin(theta_2)*cos(theta_1) - sin(theta_1)*cos(theta_3 + theta_4))*(l5_CoM*sin(theta_3 + theta_4)*sin(theta_2)*cos(theta_1) - l5_CoM*sin(theta_1)*cos(theta_3 + theta_4) - l4*sin(theta_1)*cos(theta_3) + l4*sin(theta_2)*sin(theta_3)*cos(theta_1)) + m_foot*(l6_CoM*(sin(theta_3 + theta_4 + theta_5)*sin(theta_1)*sin(theta_2) + cos(theta_3 + theta_4 + theta_5)*cos(theta_1)) + l5*(sin(theta_3 + theta_4)*sin(theta_1)*sin(theta_2) + cos(theta_3 + theta_4)*cos(theta_1)))*(l6_CoM*(sin(theta_3 + theta_4 + theta_5)*sin(theta_1)*sin(theta_2) + cos(theta_3 + theta_4 + theta_5)*cos(theta_1)) + l4*(sin(theta_1)*sin(theta_2)*sin(theta_3) + cos(theta_1)*cos(theta_3)) + l5*(sin(theta_3 + theta_4)*sin(theta_1)*sin(theta_2) + cos(theta_3 + theta_4)*cos(theta_1))) + m_foot*(l6_CoM*sin(theta_3 + theta_4 + theta_5) + l5*sin(theta_3 + theta_4))*(l6_CoM*sin(theta_3 + theta_4 + theta_5) + l4*sin(theta_3) + l5*sin(theta_3 + theta_4))*pow(cos(theta_2),2) + m_foot*(l6_CoM*sin(theta_3 + theta_4 + theta_5)*sin(theta_2)*cos(theta_1) - l6_CoM*sin(theta_1)*cos(theta_3 + theta_4 + theta_5) + l5*sin(theta_3 + theta_4)*sin(theta_2)*cos(theta_1) - l5*sin(theta_1)*cos(theta_3 + theta_4))*(l6_CoM*sin(theta_3 + theta_4 + theta_5)*sin(theta_2)*cos(theta_1) - l6_CoM*sin(theta_1)*cos(theta_3 + theta_4 + theta_5) - l4*sin(theta_1)*cos(theta_3) + l4*sin(theta_2)*sin(theta_3)*cos(theta_1) + l5*sin(theta_3 + theta_4)*sin(theta_2)*cos(theta_1) - l5*sin(theta_1)*cos(theta_3 + theta_4)) + ((sin(theta_1)*sin(theta_3) + sin(theta_2)*cos(theta_1)*cos(theta_3))*sin(theta_4) + (-sin(theta_1)*cos(theta_3) + sin(theta_2)*sin(theta_3)*cos(theta_1))*cos(theta_4))*(Ixy_foot*cos(theta_1)*cos(theta_2) + Iyy_foot*((sin(theta_1)*sin(theta_3) + sin(theta_2)*cos(theta_1)*cos(theta_3))*sin(theta_4) + (-sin(theta_1)*cos(theta_3) + sin(theta_2)*sin(theta_3)*cos(theta_1))*cos(theta_4)) + Izy_foot*((sin(theta_1)*sin(theta_3) + sin(theta_2)*cos(theta_1)*cos(theta_3))*cos(theta_4) - (-sin(theta_1)*cos(theta_3) + sin(theta_2)*sin(theta_3)*cos(theta_1))*sin(theta_4))) + ((sin(theta_1)*sin(theta_3) + sin(theta_2)*cos(theta_1)*cos(theta_3))*cos(theta_4) - (-sin(theta_1)*cos(theta_3) + sin(theta_2)*sin(theta_3)*cos(theta_1))*sin(theta_4))*(Ixz_foot*cos(theta_1)*cos(theta_2) + Iyz_foot*((sin(theta_1)*sin(theta_3) + sin(theta_2)*cos(theta_1)*cos(theta_3))*sin(theta_4) + (-sin(theta_1)*cos(theta_3) + sin(theta_2)*sin(theta_3)*cos(theta_1))*cos(theta_4)) + Izz_foot*((sin(theta_1)*sin(theta_3) + sin(theta_2)*cos(theta_1)*cos(theta_3))*cos(theta_4) - (-sin(theta_1)*cos(theta_3) + sin(theta_2)*sin(theta_3)*cos(theta_1))*sin(theta_4))) + (sin(theta_1)*sin(theta_3) + sin(theta_2)*cos(theta_1)*cos(theta_3))*(Ixz_ll*cos(theta_1)*cos(theta_2) + Iyz_ll*(-sin(theta_1)*cos(theta_3) + sin(theta_2)*sin(theta_3)*cos(theta_1)) + Izz_ll*(sin(theta_1)*sin(theta_3) + sin(theta_2)*cos(theta_1)*cos(theta_3))) + (-sin(theta_1)*cos(theta_3) + sin(theta_2)*sin(theta_3)*cos(theta_1))*(Ixy_ll*cos(theta_1)*cos(theta_2) + Iyy_ll*(-sin(theta_1)*cos(theta_3) + sin(theta_2)*sin(theta_3)*cos(theta_1)) + Izy_ll*(sin(theta_1)*sin(theta_3) + sin(theta_2)*cos(theta_1)*cos(theta_3))) + (Ixx_foot*cos(theta_1)*cos(theta_2) + Iyx_foot*((sin(theta_1)*sin(theta_3) + sin(theta_2)*cos(theta_1)*cos(theta_3))*sin(theta_4) + (-sin(theta_1)*cos(theta_3) + sin(theta_2)*sin(theta_3)*cos(theta_1))*cos(theta_4)) + Izx_foot*((sin(theta_1)*sin(theta_3) + sin(theta_2)*cos(theta_1)*cos(theta_3))*cos(theta_4) - (-sin(theta_1)*cos(theta_3) + sin(theta_2)*sin(theta_3)*cos(theta_1))*sin(theta_4)))*cos(theta_1)*cos(theta_2) + (Ixx_ll*cos(theta_1)*cos(theta_2) + Iyx_ll*(-sin(theta_1)*cos(theta_3) + sin(theta_2)*sin(theta_3)*cos(theta_1)) + Izx_ll*(sin(theta_1)*sin(theta_3) + sin(theta_2)*cos(theta_1)*cos(theta_3)))*cos(theta_1)*cos(theta_2);
    double B_15 = l6_CoM*m_foot*(sin(theta_3 + theta_4 + theta_5)*sin(theta_1)*sin(theta_2) + cos(theta_3 + theta_4 + theta_5)*cos(theta_1))*(l6_CoM*(sin(theta_3 + theta_4 + theta_5)*sin(theta_1)*sin(theta_2) + cos(theta_3 + theta_4 + theta_5)*cos(theta_1)) + l4*(sin(theta_1)*sin(theta_2)*sin(theta_3) + cos(theta_1)*cos(theta_3)) + l5*(sin(theta_3 + theta_4)*sin(theta_1)*sin(theta_2) + cos(theta_3 + theta_4)*cos(theta_1))) + l6_CoM*m_foot*(sin(theta_3 + theta_4 + theta_5)*sin(theta_2)*cos(theta_1) - sin(theta_1)*cos(theta_3 + theta_4 + theta_5))*(l6_CoM*sin(theta_3 + theta_4 + theta_5)*sin(theta_2)*cos(theta_1) - l6_CoM*sin(theta_1)*cos(theta_3 + theta_4 + theta_5) - l4*sin(theta_1)*cos(theta_3) + l4*sin(theta_2)*sin(theta_3)*cos(theta_1) + l5*sin(theta_3 + theta_4)*sin(theta_2)*cos(theta_1) - l5*sin(theta_1)*cos(theta_3 + theta_4)) + l6_CoM*m_foot*(l6_CoM*sin(theta_3 + theta_4 + theta_5) + l4*sin(theta_3) + l5*sin(theta_3 + theta_4))*sin(theta_3 + theta_4 + theta_5)*pow(cos(theta_2),2) + ((sin(theta_1)*sin(theta_3) + sin(theta_2)*cos(theta_1)*cos(theta_3))*sin(theta_4) + (-sin(theta_1)*cos(theta_3) + sin(theta_2)*sin(theta_3)*cos(theta_1))*cos(theta_4))*(Ixy_foot*cos(theta_1)*cos(theta_2) + Iyy_foot*((sin(theta_1)*sin(theta_3) + sin(theta_2)*cos(theta_1)*cos(theta_3))*sin(theta_4) + (-sin(theta_1)*cos(theta_3) + sin(theta_2)*sin(theta_3)*cos(theta_1))*cos(theta_4)) + Izy_foot*((sin(theta_1)*sin(theta_3) + sin(theta_2)*cos(theta_1)*cos(theta_3))*cos(theta_4) - (-sin(theta_1)*cos(theta_3) + sin(theta_2)*sin(theta_3)*cos(theta_1))*sin(theta_4))) + ((sin(theta_1)*sin(theta_3) + sin(theta_2)*cos(theta_1)*cos(theta_3))*cos(theta_4) - (-sin(theta_1)*cos(theta_3) + sin(theta_2)*sin(theta_3)*cos(theta_1))*sin(theta_4))*(Ixz_foot*cos(theta_1)*cos(theta_2) + Iyz_foot*((sin(theta_1)*sin(theta_3) + sin(theta_2)*cos(theta_1)*cos(theta_3))*sin(theta_4) + (-sin(theta_1)*cos(theta_3) + sin(theta_2)*sin(theta_3)*cos(theta_1))*cos(theta_4)) + Izz_foot*((sin(theta_1)*sin(theta_3) + sin(theta_2)*cos(theta_1)*cos(theta_3))*cos(theta_4) - (-sin(theta_1)*cos(theta_3) + sin(theta_2)*sin(theta_3)*cos(theta_1))*sin(theta_4))) + (Ixx_foot*cos(theta_1)*cos(theta_2) + Iyx_foot*((sin(theta_1)*sin(theta_3) + sin(theta_2)*cos(theta_1)*cos(theta_3))*sin(theta_4) + (-sin(theta_1)*cos(theta_3) + sin(theta_2)*sin(theta_3)*cos(theta_1))*cos(theta_4)) + Izx_foot*((sin(theta_1)*sin(theta_3) + sin(theta_2)*cos(theta_1)*cos(theta_3))*cos(theta_4) - (-sin(theta_1)*cos(theta_3) + sin(theta_2)*sin(theta_3)*cos(theta_1))*sin(theta_4)))*cos(theta_1)*cos(theta_2);
    double B_16 = l5_CoM*m_ll*(sin(theta_3 + theta_4)*sin(theta_1)*sin(theta_2) + cos(theta_3 + theta_4)*cos(theta_1))*(-l5_CoM*sin(theta_3 + theta_4)*sin(theta_1) - l5_CoM*sin(theta_2)*cos(theta_3 + theta_4)*cos(theta_1) - l3*sin(theta_2)*cos(theta_1) - l4*sin(theta_1)*sin(theta_3) - l4*sin(theta_2)*cos(theta_1)*cos(theta_3)) + l5_CoM*m_ll*(sin(theta_3 + theta_4)*sin(theta_2)*cos(theta_1) - sin(theta_1)*cos(theta_3 + theta_4))*(-l5_CoM*sin(theta_3 + theta_4)*cos(theta_1) + l5_CoM*sin(theta_1)*sin(theta_2)*cos(theta_3 + theta_4) + l3*sin(theta_1)*sin(theta_2) + l4*sin(theta_1)*sin(theta_2)*cos(theta_3) - l4*sin(theta_3)*cos(theta_1)) + m_foot*(l6_CoM*(sin(theta_3 + theta_4 + theta_5)*sin(theta_1)*sin(theta_2) + cos(theta_3 + theta_4 + theta_5)*cos(theta_1)) + l5*(sin(theta_3 + theta_4)*sin(theta_1)*sin(theta_2) + cos(theta_3 + theta_4)*cos(theta_1)))*(-l6_CoM*sin(theta_3 + theta_4 + theta_5)*sin(theta_1) - l6_CoM*sin(theta_2)*cos(theta_3 + theta_4 + theta_5)*cos(theta_1) - l3*sin(theta_2)*cos(theta_1) - l4*sin(theta_1)*sin(theta_3) - l4*sin(theta_2)*cos(theta_1)*cos(theta_3) - l5*sin(theta_3 + theta_4)*sin(theta_1) - l5*sin(theta_2)*cos(theta_3 + theta_4)*cos(theta_1)) + m_foot*(l6_CoM*sin(theta_3 + theta_4 + theta_5)*sin(theta_2)*cos(theta_1) - l6_CoM*sin(theta_1)*cos(theta_3 + theta_4 + theta_5) + l5*sin(theta_3 + theta_4)*sin(theta_2)*cos(theta_1) - l5*sin(theta_1)*cos(theta_3 + theta_4))*(-l6_CoM*sin(theta_3 + theta_4 + theta_5)*cos(theta_1) + l6_CoM*sin(theta_1)*sin(theta_2)*cos(theta_3 + theta_4 + theta_5) + l3*sin(theta_1)*sin(theta_2) + l4*sin(theta_1)*sin(theta_2)*cos(theta_3) - l4*sin(theta_3)*cos(theta_1) - l5*sin(theta_3 + theta_4)*cos(theta_1) + l5*sin(theta_1)*sin(theta_2)*cos(theta_3 + theta_4)) + (-sin(theta_3)*sin(theta_4)*cos(theta_2) + cos(theta_2)*cos(theta_3)*cos(theta_4))*(Ixz_foot*cos(theta_1)*cos(theta_2) + Iyz_foot*((sin(theta_1)*sin(theta_3) + sin(theta_2)*cos(theta_1)*cos(theta_3))*sin(theta_4) + (-sin(theta_1)*cos(theta_3) + sin(theta_2)*sin(theta_3)*cos(theta_1))*cos(theta_4)) + Izz_foot*((sin(theta_1)*sin(theta_3) + sin(theta_2)*cos(theta_1)*cos(theta_3))*cos(theta_4) - (-sin(theta_1)*cos(theta_3) + sin(theta_2)*sin(theta_3)*cos(theta_1))*sin(theta_4))) + (sin(theta_3)*cos(theta_2)*cos(theta_4) + sin(theta_4)*cos(theta_2)*cos(theta_3))*(Ixy_foot*cos(theta_1)*cos(theta_2) + Iyy_foot*((sin(theta_1)*sin(theta_3) + sin(theta_2)*cos(theta_1)*cos(theta_3))*sin(theta_4) + (-sin(theta_1)*cos(theta_3) + sin(theta_2)*sin(theta_3)*cos(theta_1))*cos(theta_4)) + Izy_foot*((sin(theta_1)*sin(theta_3) + sin(theta_2)*cos(theta_1)*cos(theta_3))*cos(theta_4) - (-sin(theta_1)*cos(theta_3) + sin(theta_2)*sin(theta_3)*cos(theta_1))*sin(theta_4))) - (Ixx_foot*cos(theta_1)*cos(theta_2) + Iyx_foot*((sin(theta_1)*sin(theta_3) + sin(theta_2)*cos(theta_1)*cos(theta_3))*sin(theta_4) + (-sin(theta_1)*cos(theta_3) + sin(theta_2)*sin(theta_3)*cos(theta_1))*cos(theta_4)) + Izx_foot*((sin(theta_1)*sin(theta_3) + sin(theta_2)*cos(theta_1)*cos(theta_3))*cos(theta_4) - (-sin(theta_1)*cos(theta_3) + sin(theta_2)*sin(theta_3)*cos(theta_1))*sin(theta_4)))*sin(theta_2) - (Ixx_ll*cos(theta_1)*cos(theta_2) + Iyx_ll*(-sin(theta_1)*cos(theta_3) + sin(theta_2)*sin(theta_3)*cos(theta_1)) + Izx_ll*(sin(theta_1)*sin(theta_3) + sin(theta_2)*cos(theta_1)*cos(theta_3)))*sin(theta_2) + (Ixy_ll*cos(theta_1)*cos(theta_2) + Iyy_ll*(-sin(theta_1)*cos(theta_3) + sin(theta_2)*sin(theta_3)*cos(theta_1)) + Izy_ll*(sin(theta_1)*sin(theta_3) + sin(theta_2)*cos(theta_1)*cos(theta_3)))*sin(theta_3)*cos(theta_2) + (Ixz_ll*cos(theta_1)*cos(theta_2) + Iyz_ll*(-sin(theta_1)*cos(theta_3) + sin(theta_2)*sin(theta_3)*cos(theta_1)) + Izz_ll*(sin(theta_1)*sin(theta_3) + sin(theta_2)*cos(theta_1)*cos(theta_3)))*cos(theta_2)*cos(theta_3);
    double B_17 = -l5_CoM*m_ll*(sin(theta_3 + theta_4)*sin(theta_1)*sin(theta_2) + cos(theta_3 + theta_4)*cos(theta_1))*(l5_CoM*cos(theta_3 + theta_4) + l3 + l4*cos(theta_3))*sin(theta_1)*cos(theta_2) - l5_CoM*m_ll*(sin(theta_3 + theta_4)*sin(theta_2)*cos(theta_1) - sin(theta_1)*cos(theta_3 + theta_4))*(l5_CoM*cos(theta_3 + theta_4) + l3 + l4*cos(theta_3))*cos(theta_1)*cos(theta_2) + l5_CoM*m_ll*(l5_CoM*cos(theta_3 + theta_4) + l3 + l4*cos(theta_3))*sin(theta_3 + theta_4)*sin(theta_2)*cos(theta_2) - m_foot*(l6_CoM*(sin(theta_3 + theta_4 + theta_5)*sin(theta_1)*sin(theta_2) + cos(theta_3 + theta_4 + theta_5)*cos(theta_1)) + l5*(sin(theta_3 + theta_4)*sin(theta_1)*sin(theta_2) + cos(theta_3 + theta_4)*cos(theta_1)))*(l6_CoM*cos(theta_3 + theta_4 + theta_5) + l3 + l4*cos(theta_3) + l5*cos(theta_3 + theta_4))*sin(theta_1)*cos(theta_2) + m_foot*(l6_CoM*sin(theta_3 + theta_4 + theta_5) + l5*sin(theta_3 + theta_4))*(l6_CoM*cos(theta_3 + theta_4 + theta_5) + l3 + l4*cos(theta_3) + l5*cos(theta_3 + theta_4))*sin(theta_2)*cos(theta_2) - m_foot*(l6_CoM*cos(theta_3 + theta_4 + theta_5) + l3 + l4*cos(theta_3) + l5*cos(theta_3 + theta_4))*(l6_CoM*sin(theta_3 + theta_4 + theta_5)*sin(theta_2)*cos(theta_1) - l6_CoM*sin(theta_1)*cos(theta_3 + theta_4 + theta_5) + l5*sin(theta_3 + theta_4)*sin(theta_2)*cos(theta_1) - l5*sin(theta_1)*cos(theta_3 + theta_4))*cos(theta_1)*cos(theta_2) + (-(sin(theta_1)*sin(theta_2)*sin(theta_3) + cos(theta_1)*cos(theta_3))*sin(theta_4) + (sin(theta_1)*sin(theta_2)*cos(theta_3) - sin(theta_3)*cos(theta_1))*cos(theta_4))*(Ixz_foot*cos(theta_1)*cos(theta_2) + Iyz_foot*((sin(theta_1)*sin(theta_3) + sin(theta_2)*cos(theta_1)*cos(theta_3))*sin(theta_4) + (-sin(theta_1)*cos(theta_3) + sin(theta_2)*sin(theta_3)*cos(theta_1))*cos(theta_4)) + Izz_foot*((sin(theta_1)*sin(theta_3) + sin(theta_2)*cos(theta_1)*cos(theta_3))*cos(theta_4) - (-sin(theta_1)*cos(theta_3) + sin(theta_2)*sin(theta_3)*cos(theta_1))*sin(theta_4))) + ((sin(theta_1)*sin(theta_2)*sin(theta_3) + cos(theta_1)*cos(theta_3))*cos(theta_4) + (sin(theta_1)*sin(theta_2)*cos(theta_3) - sin(theta_3)*cos(theta_1))*sin(theta_4))*(Ixy_foot*cos(theta_1)*cos(theta_2) + Iyy_foot*((sin(theta_1)*sin(theta_3) + sin(theta_2)*cos(theta_1)*cos(theta_3))*sin(theta_4) + (-sin(theta_1)*cos(theta_3) + sin(theta_2)*sin(theta_3)*cos(theta_1))*cos(theta_4)) + Izy_foot*((sin(theta_1)*sin(theta_3) + sin(theta_2)*cos(theta_1)*cos(theta_3))*cos(theta_4) - (-sin(theta_1)*cos(theta_3) + sin(theta_2)*sin(theta_3)*cos(theta_1))*sin(theta_4))) + (sin(theta_1)*sin(theta_2)*sin(theta_3) + cos(theta_1)*cos(theta_3))*(Ixy_ll*cos(theta_1)*cos(theta_2) + Iyy_ll*(-sin(theta_1)*cos(theta_3) + sin(theta_2)*sin(theta_3)*cos(theta_1)) + Izy_ll*(sin(theta_1)*sin(theta_3) + sin(theta_2)*cos(theta_1)*cos(theta_3))) + (sin(theta_1)*sin(theta_2)*cos(theta_3) - sin(theta_3)*cos(theta_1))*(Ixz_ll*cos(theta_1)*cos(theta_2) + Iyz_ll*(-sin(theta_1)*cos(theta_3) + sin(theta_2)*sin(theta_3)*cos(theta_1)) + Izz_ll*(sin(theta_1)*sin(theta_3) + sin(theta_2)*cos(theta_1)*cos(theta_3))) + (Ixx_foot*cos(theta_1)*cos(theta_2) + Iyx_foot*((sin(theta_1)*sin(theta_3) + sin(theta_2)*cos(theta_1)*cos(theta_3))*sin(theta_4) + (-sin(theta_1)*cos(theta_3) + sin(theta_2)*sin(theta_3)*cos(theta_1))*cos(theta_4)) + Izx_foot*((sin(theta_1)*sin(theta_3) + sin(theta_2)*cos(theta_1)*cos(theta_3))*cos(theta_4) - (-sin(theta_1)*cos(theta_3) + sin(theta_2)*sin(theta_3)*cos(theta_1))*sin(theta_4)))*sin(theta_1)*cos(theta_2) + (Ixx_ll*cos(theta_1)*cos(theta_2) + Iyx_ll*(-sin(theta_1)*cos(theta_3) + sin(theta_2)*sin(theta_3)*cos(theta_1)) + Izx_ll*(sin(theta_1)*sin(theta_3) + sin(theta_2)*cos(theta_1)*cos(theta_3)))*sin(theta_1)*cos(theta_2);
    double B_18 = l5_CoM*m_ll*(l5_CoM*(sin(theta_3 + theta_4)*sin(theta_1)*sin(theta_2) + cos(theta_3 + theta_4)*cos(theta_1)) + l4*(sin(theta_1)*sin(theta_2)*sin(theta_3) + cos(theta_1)*cos(theta_3)))*(sin(theta_3 + theta_4)*sin(theta_1)*sin(theta_2) + cos(theta_3 + theta_4)*cos(theta_1)) + l5_CoM*m_ll*(l5_CoM*sin(theta_3 + theta_4) + l4*sin(theta_3))*sin(theta_3 + theta_4)*pow(cos(theta_2),2) + l5_CoM*m_ll*(sin(theta_3 + theta_4)*sin(theta_2)*cos(theta_1) - sin(theta_1)*cos(theta_3 + theta_4))*(l5_CoM*sin(theta_3 + theta_4)*sin(theta_2)*cos(theta_1) - l5_CoM*sin(theta_1)*cos(theta_3 + theta_4) - l4*sin(theta_1)*cos(theta_3) + l4*sin(theta_2)*sin(theta_3)*cos(theta_1)) + m_foot*(l6_CoM*(sin(theta_3 + theta_4 + theta_5)*sin(theta_1)*sin(theta_2) + cos(theta_3 + theta_4 + theta_5)*cos(theta_1)) + l5*(sin(theta_3 + theta_4)*sin(theta_1)*sin(theta_2) + cos(theta_3 + theta_4)*cos(theta_1)))*(l6_CoM*(sin(theta_3 + theta_4 + theta_5)*sin(theta_1)*sin(theta_2) + cos(theta_3 + theta_4 + theta_5)*cos(theta_1)) + l4*(sin(theta_1)*sin(theta_2)*sin(theta_3) + cos(theta_1)*cos(theta_3)) + l5*(sin(theta_3 + theta_4)*sin(theta_1)*sin(theta_2) + cos(theta_3 + theta_4)*cos(theta_1))) + m_foot*(l6_CoM*sin(theta_3 + theta_4 + theta_5) + l5*sin(theta_3 + theta_4))*(l6_CoM*sin(theta_3 + theta_4 + theta_5) + l4*sin(theta_3) + l5*sin(theta_3 + theta_4))*pow(cos(theta_2),2) + m_foot*(l6_CoM*sin(theta_3 + theta_4 + theta_5)*sin(theta_2)*cos(theta_1) - l6_CoM*sin(theta_1)*cos(theta_3 + theta_4 + theta_5) + l5*sin(theta_3 + theta_4)*sin(theta_2)*cos(theta_1) - l5*sin(theta_1)*cos(theta_3 + theta_4))*(l6_CoM*sin(theta_3 + theta_4 + theta_5)*sin(theta_2)*cos(theta_1) - l6_CoM*sin(theta_1)*cos(theta_3 + theta_4 + theta_5) - l4*sin(theta_1)*cos(theta_3) + l4*sin(theta_2)*sin(theta_3)*cos(theta_1) + l5*sin(theta_3 + theta_4)*sin(theta_2)*cos(theta_1) - l5*sin(theta_1)*cos(theta_3 + theta_4)) + ((sin(theta_1)*sin(theta_3) + sin(theta_2)*cos(theta_1)*cos(theta_3))*sin(theta_4) + (-sin(theta_1)*cos(theta_3) + sin(theta_2)*sin(theta_3)*cos(theta_1))*cos(theta_4))*(Ixy_foot*cos(theta_1)*cos(theta_2) + Iyy_foot*((sin(theta_1)*sin(theta_3) + sin(theta_2)*cos(theta_1)*cos(theta_3))*sin(theta_4) + (-sin(theta_1)*cos(theta_3) + sin(theta_2)*sin(theta_3)*cos(theta_1))*cos(theta_4)) + Izy_foot*((sin(theta_1)*sin(theta_3) + sin(theta_2)*cos(theta_1)*cos(theta_3))*cos(theta_4) - (-sin(theta_1)*cos(theta_3) + sin(theta_2)*sin(theta_3)*cos(theta_1))*sin(theta_4))) + ((sin(theta_1)*sin(theta_3) + sin(theta_2)*cos(theta_1)*cos(theta_3))*cos(theta_4) - (-sin(theta_1)*cos(theta_3) + sin(theta_2)*sin(theta_3)*cos(theta_1))*sin(theta_4))*(Ixz_foot*cos(theta_1)*cos(theta_2) + Iyz_foot*((sin(theta_1)*sin(theta_3) + sin(theta_2)*cos(theta_1)*cos(theta_3))*sin(theta_4) + (-sin(theta_1)*cos(theta_3) + sin(theta_2)*sin(theta_3)*cos(theta_1))*cos(theta_4)) + Izz_foot*((sin(theta_1)*sin(theta_3) + sin(theta_2)*cos(theta_1)*cos(theta_3))*cos(theta_4) - (-sin(theta_1)*cos(theta_3) + sin(theta_2)*sin(theta_3)*cos(theta_1))*sin(theta_4))) + (sin(theta_1)*sin(theta_3) + sin(theta_2)*cos(theta_1)*cos(theta_3))*(Ixz_ll*cos(theta_1)*cos(theta_2) + Iyz_ll*(-sin(theta_1)*cos(theta_3) + sin(theta_2)*sin(theta_3)*cos(theta_1)) + Izz_ll*(sin(theta_1)*sin(theta_3) + sin(theta_2)*cos(theta_1)*cos(theta_3))) + (-sin(theta_1)*cos(theta_3) + sin(theta_2)*sin(theta_3)*cos(theta_1))*(Ixy_ll*cos(theta_1)*cos(theta_2) + Iyy_ll*(-sin(theta_1)*cos(theta_3) + sin(theta_2)*sin(theta_3)*cos(theta_1)) + Izy_ll*(sin(theta_1)*sin(theta_3) + sin(theta_2)*cos(theta_1)*cos(theta_3))) + (Ixx_foot*cos(theta_1)*cos(theta_2) + Iyx_foot*((sin(theta_1)*sin(theta_3) + sin(theta_2)*cos(theta_1)*cos(theta_3))*sin(theta_4) + (-sin(theta_1)*cos(theta_3) + sin(theta_2)*sin(theta_3)*cos(theta_1))*cos(theta_4)) + Izx_foot*((sin(theta_1)*sin(theta_3) + sin(theta_2)*cos(theta_1)*cos(theta_3))*cos(theta_4) - (-sin(theta_1)*cos(theta_3) + sin(theta_2)*sin(theta_3)*cos(theta_1))*sin(theta_4)))*cos(theta_1)*cos(theta_2) + (Ixx_ll*cos(theta_1)*cos(theta_2) + Iyx_ll*(-sin(theta_1)*cos(theta_3) + sin(theta_2)*sin(theta_3)*cos(theta_1)) + Izx_ll*(sin(theta_1)*sin(theta_3) + sin(theta_2)*cos(theta_1)*cos(theta_3)))*cos(theta_1)*cos(theta_2);;
    double B_19 = pow(l5_CoM,2)*m_ll*pow((sin(theta_3 + theta_4)*sin(theta_1)*sin(theta_2) + cos(theta_3 + theta_4)*cos(theta_1)),2) + pow(l5_CoM,2)*m_ll*pow((sin(theta_3 + theta_4)*sin(theta_2)*cos(theta_1) - sin(theta_1)*cos(theta_3 + theta_4)),2) + pow(l5_CoM,2)*m_ll*pow(sin(theta_3 + theta_4),2)*pow(cos(theta_2),2) + m_foot*pow((l6_CoM*(sin(theta_3 + theta_4 + theta_5)*sin(theta_1)*sin(theta_2) + cos(theta_3 + theta_4 + theta_5)*cos(theta_1)) + l5*(sin(theta_3 + theta_4)*sin(theta_1)*sin(theta_2) + cos(theta_3 + theta_4)*cos(theta_1))),2) + m_foot*pow((l6_CoM*sin(theta_3 + theta_4 + theta_5) + l5*sin(theta_3 + theta_4)),2)*pow(cos(theta_2),2) + m_foot*pow((l6_CoM*sin(theta_3 + theta_4 + theta_5)*sin(theta_2)*cos(theta_1) - l6_CoM*sin(theta_1)*cos(theta_3 + theta_4 + theta_5) + l5*sin(theta_3 + theta_4)*sin(theta_2)*cos(theta_1) - l5*sin(theta_1)*cos(theta_3 + theta_4)),2) + ((sin(theta_1)*sin(theta_3) + sin(theta_2)*cos(theta_1)*cos(theta_3))*sin(theta_4) + (-sin(theta_1)*cos(theta_3) + sin(theta_2)*sin(theta_3)*cos(theta_1))*cos(theta_4))*(Ixy_foot*cos(theta_1)*cos(theta_2) + Iyy_foot*((sin(theta_1)*sin(theta_3) + sin(theta_2)*cos(theta_1)*cos(theta_3))*sin(theta_4) + (-sin(theta_1)*cos(theta_3) + sin(theta_2)*sin(theta_3)*cos(theta_1))*cos(theta_4)) + Izy_foot*((sin(theta_1)*sin(theta_3) + sin(theta_2)*cos(theta_1)*cos(theta_3))*cos(theta_4) - (-sin(theta_1)*cos(theta_3) + sin(theta_2)*sin(theta_3)*cos(theta_1))*sin(theta_4))) + ((sin(theta_1)*sin(theta_3) + sin(theta_2)*cos(theta_1)*cos(theta_3))*cos(theta_4) - (-sin(theta_1)*cos(theta_3) + sin(theta_2)*sin(theta_3)*cos(theta_1))*sin(theta_4))*(Ixz_foot*cos(theta_1)*cos(theta_2) + Iyz_foot*((sin(theta_1)*sin(theta_3) + sin(theta_2)*cos(theta_1)*cos(theta_3))*sin(theta_4) + (-sin(theta_1)*cos(theta_3) + sin(theta_2)*sin(theta_3)*cos(theta_1))*cos(theta_4)) + Izz_foot*((sin(theta_1)*sin(theta_3) + sin(theta_2)*cos(theta_1)*cos(theta_3))*cos(theta_4) - (-sin(theta_1)*cos(theta_3) + sin(theta_2)*sin(theta_3)*cos(theta_1))*sin(theta_4))) + (sin(theta_1)*sin(theta_3) + sin(theta_2)*cos(theta_1)*cos(theta_3))*(Ixz_ll*cos(theta_1)*cos(theta_2) + Iyz_ll*(-sin(theta_1)*cos(theta_3) + sin(theta_2)*sin(theta_3)*cos(theta_1)) + Izz_ll*(sin(theta_1)*sin(theta_3) + sin(theta_2)*cos(theta_1)*cos(theta_3))) + (-sin(theta_1)*cos(theta_3) + sin(theta_2)*sin(theta_3)*cos(theta_1))*(Ixy_ll*cos(theta_1)*cos(theta_2) + Iyy_ll*(-sin(theta_1)*cos(theta_3) + sin(theta_2)*sin(theta_3)*cos(theta_1)) + Izy_ll*(sin(theta_1)*sin(theta_3) + sin(theta_2)*cos(theta_1)*cos(theta_3))) + (Ixx_foot*cos(theta_1)*cos(theta_2) + Iyx_foot*((sin(theta_1)*sin(theta_3) + sin(theta_2)*cos(theta_1)*cos(theta_3))*sin(theta_4) + (-sin(theta_1)*cos(theta_3) + sin(theta_2)*sin(theta_3)*cos(theta_1))*cos(theta_4)) + Izx_foot*((sin(theta_1)*sin(theta_3) + sin(theta_2)*cos(theta_1)*cos(theta_3))*cos(theta_4) - (-sin(theta_1)*cos(theta_3) + sin(theta_2)*sin(theta_3)*cos(theta_1))*sin(theta_4)))*cos(theta_1)*cos(theta_2) + (Ixx_ll*cos(theta_1)*cos(theta_2) + Iyx_ll*(-sin(theta_1)*cos(theta_3) + sin(theta_2)*sin(theta_3)*cos(theta_1)) + Izx_ll*(sin(theta_1)*sin(theta_3) + sin(theta_2)*cos(theta_1)*cos(theta_3)))*cos(theta_1)*cos(theta_2);
    double B_20 = l6_CoM*m_foot*(l6_CoM*(sin(theta_3 + theta_4 + theta_5)*sin(theta_1)*sin(theta_2) + cos(theta_3 + theta_4 + theta_5)*cos(theta_1)) + l5*(sin(theta_3 + theta_4)*sin(theta_1)*sin(theta_2) + cos(theta_3 + theta_4)*cos(theta_1)))*(sin(theta_3 + theta_4 + theta_5)*sin(theta_1)*sin(theta_2) + cos(theta_3 + theta_4 + theta_5)*cos(theta_1)) + l6_CoM*m_foot*(l6_CoM*sin(theta_3 + theta_4 + theta_5) + l5*sin(theta_3 + theta_4))*sin(theta_3 + theta_4 + theta_5)*pow(cos(theta_2),2) + l6_CoM*m_foot*(sin(theta_3 + theta_4 + theta_5)*sin(theta_2)*cos(theta_1) - sin(theta_1)*cos(theta_3 + theta_4 + theta_5))*(l6_CoM*sin(theta_3 + theta_4 + theta_5)*sin(theta_2)*cos(theta_1) - l6_CoM*sin(theta_1)*cos(theta_3 + theta_4 + theta_5) + l5*sin(theta_3 + theta_4)*sin(theta_2)*cos(theta_1) - l5*sin(theta_1)*cos(theta_3 + theta_4)) + ((sin(theta_1)*sin(theta_3) + sin(theta_2)*cos(theta_1)*cos(theta_3))*sin(theta_4) + (-sin(theta_1)*cos(theta_3) + sin(theta_2)*sin(theta_3)*cos(theta_1))*cos(theta_4))*(Ixy_foot*cos(theta_1)*cos(theta_2) + Iyy_foot*((sin(theta_1)*sin(theta_3) + sin(theta_2)*cos(theta_1)*cos(theta_3))*sin(theta_4) + (-sin(theta_1)*cos(theta_3) + sin(theta_2)*sin(theta_3)*cos(theta_1))*cos(theta_4)) + Izy_foot*((sin(theta_1)*sin(theta_3) + sin(theta_2)*cos(theta_1)*cos(theta_3))*cos(theta_4) - (-sin(theta_1)*cos(theta_3) + sin(theta_2)*sin(theta_3)*cos(theta_1))*sin(theta_4))) + ((sin(theta_1)*sin(theta_3) + sin(theta_2)*cos(theta_1)*cos(theta_3))*cos(theta_4) - (-sin(theta_1)*cos(theta_3) + sin(theta_2)*sin(theta_3)*cos(theta_1))*sin(theta_4))*(Ixz_foot*cos(theta_1)*cos(theta_2) + Iyz_foot*((sin(theta_1)*sin(theta_3) + sin(theta_2)*cos(theta_1)*cos(theta_3))*sin(theta_4) + (-sin(theta_1)*cos(theta_3) + sin(theta_2)*sin(theta_3)*cos(theta_1))*cos(theta_4)) + Izz_foot*((sin(theta_1)*sin(theta_3) + sin(theta_2)*cos(theta_1)*cos(theta_3))*cos(theta_4) - (-sin(theta_1)*cos(theta_3) + sin(theta_2)*sin(theta_3)*cos(theta_1))*sin(theta_4))) + (Ixx_foot*cos(theta_1)*cos(theta_2) + Iyx_foot*((sin(theta_1)*sin(theta_3) + sin(theta_2)*cos(theta_1)*cos(theta_3))*sin(theta_4) + (-sin(theta_1)*cos(theta_3) + sin(theta_2)*sin(theta_3)*cos(theta_1))*cos(theta_4)) + Izx_foot*((sin(theta_1)*sin(theta_3) + sin(theta_2)*cos(theta_1)*cos(theta_3))*cos(theta_4) - (-sin(theta_1)*cos(theta_3) + sin(theta_2)*sin(theta_3)*cos(theta_1))*sin(theta_4)))*cos(theta_1)*cos(theta_2);
    double B_21 = l6_CoM*m_foot*(sin(theta_3 + theta_4 + theta_5)*sin(theta_1)*sin(theta_2) + cos(theta_3 + theta_4 + theta_5)*cos(theta_1))*(-l6_CoM*sin(theta_3 + theta_4 + theta_5)*sin(theta_1) - l6_CoM*sin(theta_2)*cos(theta_3 + theta_4 + theta_5)*cos(theta_1) - l3*sin(theta_2)*cos(theta_1) - l4*sin(theta_1)*sin(theta_3) - l4*sin(theta_2)*cos(theta_1)*cos(theta_3) - l5*sin(theta_3 + theta_4)*sin(theta_1) - l5*sin(theta_2)*cos(theta_3 + theta_4)*cos(theta_1)) + l6_CoM*m_foot*(sin(theta_3 + theta_4 + theta_5)*sin(theta_2)*cos(theta_1) - sin(theta_1)*cos(theta_3 + theta_4 + theta_5))*(-l6_CoM*sin(theta_3 + theta_4 + theta_5)*cos(theta_1) + l6_CoM*sin(theta_1)*sin(theta_2)*cos(theta_3 + theta_4 + theta_5) + l3*sin(theta_1)*sin(theta_2) + l4*sin(theta_1)*sin(theta_2)*cos(theta_3) - l4*sin(theta_3)*cos(theta_1) - l5*sin(theta_3 + theta_4)*cos(theta_1) + l5*sin(theta_1)*sin(theta_2)*cos(theta_3 + theta_4)) + (-sin(theta_3)*sin(theta_4)*cos(theta_2) + cos(theta_2)*cos(theta_3)*cos(theta_4))*(Ixz_foot*cos(theta_1)*cos(theta_2) + Iyz_foot*((sin(theta_1)*sin(theta_3) + sin(theta_2)*cos(theta_1)*cos(theta_3))*sin(theta_4) + (-sin(theta_1)*cos(theta_3) + sin(theta_2)*sin(theta_3)*cos(theta_1))*cos(theta_4)) + Izz_foot*((sin(theta_1)*sin(theta_3) + sin(theta_2)*cos(theta_1)*cos(theta_3))*cos(theta_4) - (-sin(theta_1)*cos(theta_3) + sin(theta_2)*sin(theta_3)*cos(theta_1))*sin(theta_4))) + (sin(theta_3)*cos(theta_2)*cos(theta_4) + sin(theta_4)*cos(theta_2)*cos(theta_3))*(Ixy_foot*cos(theta_1)*cos(theta_2) + Iyy_foot*((sin(theta_1)*sin(theta_3) + sin(theta_2)*cos(theta_1)*cos(theta_3))*sin(theta_4) + (-sin(theta_1)*cos(theta_3) + sin(theta_2)*sin(theta_3)*cos(theta_1))*cos(theta_4)) + Izy_foot*((sin(theta_1)*sin(theta_3) + sin(theta_2)*cos(theta_1)*cos(theta_3))*cos(theta_4) - (-sin(theta_1)*cos(theta_3) + sin(theta_2)*sin(theta_3)*cos(theta_1))*sin(theta_4))) - (Ixx_foot*cos(theta_1)*cos(theta_2) + Iyx_foot*((sin(theta_1)*sin(theta_3) + sin(theta_2)*cos(theta_1)*cos(theta_3))*sin(theta_4) + (-sin(theta_1)*cos(theta_3) + sin(theta_2)*sin(theta_3)*cos(theta_1))*cos(theta_4)) + Izx_foot*((sin(theta_1)*sin(theta_3) + sin(theta_2)*cos(theta_1)*cos(theta_3))*cos(theta_4) - (-sin(theta_1)*cos(theta_3) + sin(theta_2)*sin(theta_3)*cos(theta_1))*sin(theta_4)))*sin(theta_2);
    double B_22 = -l6_CoM*m_foot*(sin(theta_3 + theta_4 + theta_5)*sin(theta_1)*sin(theta_2) + cos(theta_3 + theta_4 + theta_5)*cos(theta_1))*(l6_CoM*cos(theta_3 + theta_4 + theta_5) + l3 + l4*cos(theta_3) + l5*cos(theta_3 + theta_4))*sin(theta_1)*cos(theta_2) - l6_CoM*m_foot*(sin(theta_3 + theta_4 + theta_5)*sin(theta_2)*cos(theta_1) - sin(theta_1)*cos(theta_3 + theta_4 + theta_5))*(l6_CoM*cos(theta_3 + theta_4 + theta_5) + l3 + l4*cos(theta_3) + l5*cos(theta_3 + theta_4))*cos(theta_1)*cos(theta_2) + l6_CoM*m_foot*(l6_CoM*cos(theta_3 + theta_4 + theta_5) + l3 + l4*cos(theta_3) + l5*cos(theta_3 + theta_4))*sin(theta_3 + theta_4 + theta_5)*sin(theta_2)*cos(theta_2) + (-(sin(theta_1)*sin(theta_2)*sin(theta_3) + cos(theta_1)*cos(theta_3))*sin(theta_4) + (sin(theta_1)*sin(theta_2)*cos(theta_3) - sin(theta_3)*cos(theta_1))*cos(theta_4))*(Ixz_foot*cos(theta_1)*cos(theta_2) + Iyz_foot*((sin(theta_1)*sin(theta_3) + sin(theta_2)*cos(theta_1)*cos(theta_3))*sin(theta_4) + (-sin(theta_1)*cos(theta_3) + sin(theta_2)*sin(theta_3)*cos(theta_1))*cos(theta_4)) + Izz_foot*((sin(theta_1)*sin(theta_3) + sin(theta_2)*cos(theta_1)*cos(theta_3))*cos(theta_4) - (-sin(theta_1)*cos(theta_3) + sin(theta_2)*sin(theta_3)*cos(theta_1))*sin(theta_4))) + ((sin(theta_1)*sin(theta_2)*sin(theta_3) + cos(theta_1)*cos(theta_3))*cos(theta_4) + (sin(theta_1)*sin(theta_2)*cos(theta_3) - sin(theta_3)*cos(theta_1))*sin(theta_4))*(Ixy_foot*cos(theta_1)*cos(theta_2) + Iyy_foot*((sin(theta_1)*sin(theta_3) + sin(theta_2)*cos(theta_1)*cos(theta_3))*sin(theta_4) + (-sin(theta_1)*cos(theta_3) + sin(theta_2)*sin(theta_3)*cos(theta_1))*cos(theta_4)) + Izy_foot*((sin(theta_1)*sin(theta_3) + sin(theta_2)*cos(theta_1)*cos(theta_3))*cos(theta_4) - (-sin(theta_1)*cos(theta_3) + sin(theta_2)*sin(theta_3)*cos(theta_1))*sin(theta_4))) + (Ixx_foot*cos(theta_1)*cos(theta_2) + Iyx_foot*((sin(theta_1)*sin(theta_3) + sin(theta_2)*cos(theta_1)*cos(theta_3))*sin(theta_4) + (-sin(theta_1)*cos(theta_3) + sin(theta_2)*sin(theta_3)*cos(theta_1))*cos(theta_4)) + Izx_foot*((sin(theta_1)*sin(theta_3) + sin(theta_2)*cos(theta_1)*cos(theta_3))*cos(theta_4) - (-sin(theta_1)*cos(theta_3) + sin(theta_2)*sin(theta_3)*cos(theta_1))*sin(theta_4)))*sin(theta_1)*cos(theta_2);
    double B_23 = l6_CoM*m_foot*(sin(theta_3 + theta_4 + theta_5)*sin(theta_1)*sin(theta_2) + cos(theta_3 + theta_4 + theta_5)*cos(theta_1))*(l6_CoM*(sin(theta_3 + theta_4 + theta_5)*sin(theta_1)*sin(theta_2) + cos(theta_3 + theta_4 + theta_5)*cos(theta_1)) + l4*(sin(theta_1)*sin(theta_2)*sin(theta_3) + cos(theta_1)*cos(theta_3)) + l5*(sin(theta_3 + theta_4)*sin(theta_1)*sin(theta_2) + cos(theta_3 + theta_4)*cos(theta_1))) + l6_CoM*m_foot*(sin(theta_3 + theta_4 + theta_5)*sin(theta_2)*cos(theta_1) - sin(theta_1)*cos(theta_3 + theta_4 + theta_5))*(l6_CoM*sin(theta_3 + theta_4 + theta_5)*sin(theta_2)*cos(theta_1) - l6_CoM*sin(theta_1)*cos(theta_3 + theta_4 + theta_5) - l4*sin(theta_1)*cos(theta_3) + l4*sin(theta_2)*sin(theta_3)*cos(theta_1) + l5*sin(theta_3 + theta_4)*sin(theta_2)*cos(theta_1) - l5*sin(theta_1)*cos(theta_3 + theta_4)) + l6_CoM*m_foot*(l6_CoM*sin(theta_3 + theta_4 + theta_5) + l4*sin(theta_3) + l5*sin(theta_3 + theta_4))*sin(theta_3 + theta_4 + theta_5)*pow(cos(theta_2),2) + ((sin(theta_1)*sin(theta_3) + sin(theta_2)*cos(theta_1)*cos(theta_3))*sin(theta_4) + (-sin(theta_1)*cos(theta_3) + sin(theta_2)*sin(theta_3)*cos(theta_1))*cos(theta_4))*(Ixy_foot*cos(theta_1)*cos(theta_2) + Iyy_foot*((sin(theta_1)*sin(theta_3) + sin(theta_2)*cos(theta_1)*cos(theta_3))*sin(theta_4) + (-sin(theta_1)*cos(theta_3) + sin(theta_2)*sin(theta_3)*cos(theta_1))*cos(theta_4)) + Izy_foot*((sin(theta_1)*sin(theta_3) + sin(theta_2)*cos(theta_1)*cos(theta_3))*cos(theta_4) - (-sin(theta_1)*cos(theta_3) + sin(theta_2)*sin(theta_3)*cos(theta_1))*sin(theta_4))) + ((sin(theta_1)*sin(theta_3) + sin(theta_2)*cos(theta_1)*cos(theta_3))*cos(theta_4) - (-sin(theta_1)*cos(theta_3) + sin(theta_2)*sin(theta_3)*cos(theta_1))*sin(theta_4))*(Ixz_foot*cos(theta_1)*cos(theta_2) + Iyz_foot*((sin(theta_1)*sin(theta_3) + sin(theta_2)*cos(theta_1)*cos(theta_3))*sin(theta_4) + (-sin(theta_1)*cos(theta_3) + sin(theta_2)*sin(theta_3)*cos(theta_1))*cos(theta_4)) + Izz_foot*((sin(theta_1)*sin(theta_3) + sin(theta_2)*cos(theta_1)*cos(theta_3))*cos(theta_4) - (-sin(theta_1)*cos(theta_3) + sin(theta_2)*sin(theta_3)*cos(theta_1))*sin(theta_4))) + (Ixx_foot*cos(theta_1)*cos(theta_2) + Iyx_foot*((sin(theta_1)*sin(theta_3) + sin(theta_2)*cos(theta_1)*cos(theta_3))*sin(theta_4) + (-sin(theta_1)*cos(theta_3) + sin(theta_2)*sin(theta_3)*cos(theta_1))*cos(theta_4)) + Izx_foot*((sin(theta_1)*sin(theta_3) + sin(theta_2)*cos(theta_1)*cos(theta_3))*cos(theta_4) - (-sin(theta_1)*cos(theta_3) + sin(theta_2)*sin(theta_3)*cos(theta_1))*sin(theta_4)))*cos(theta_1)*cos(theta_2);
    double B_24 = l6_CoM*m_foot*(l6_CoM*(sin(theta_3 + theta_4 + theta_5)*sin(theta_1)*sin(theta_2) + cos(theta_3 + theta_4 + theta_5)*cos(theta_1)) + l5*(sin(theta_3 + theta_4)*sin(theta_1)*sin(theta_2) + cos(theta_3 + theta_4)*cos(theta_1)))*(sin(theta_3 + theta_4 + theta_5)*sin(theta_1)*sin(theta_2) + cos(theta_3 + theta_4 + theta_5)*cos(theta_1)) + l6_CoM*m_foot*(l6_CoM*sin(theta_3 + theta_4 + theta_5) + l5*sin(theta_3 + theta_4))*sin(theta_3 + theta_4 + theta_5)*pow(cos(theta_2),2) + l6_CoM*m_foot*(sin(theta_3 + theta_4 + theta_5)*sin(theta_2)*cos(theta_1) - sin(theta_1)*cos(theta_3 + theta_4 + theta_5))*(l6_CoM*sin(theta_3 + theta_4 + theta_5)*sin(theta_2)*cos(theta_1) - l6_CoM*sin(theta_1)*cos(theta_3 + theta_4 + theta_5) + l5*sin(theta_3 + theta_4)*sin(theta_2)*cos(theta_1) - l5*sin(theta_1)*cos(theta_3 + theta_4)) + ((sin(theta_1)*sin(theta_3) + sin(theta_2)*cos(theta_1)*cos(theta_3))*sin(theta_4) + (-sin(theta_1)*cos(theta_3) + sin(theta_2)*sin(theta_3)*cos(theta_1))*cos(theta_4))*(Ixy_foot*cos(theta_1)*cos(theta_2) + Iyy_foot*((sin(theta_1)*sin(theta_3) + sin(theta_2)*cos(theta_1)*cos(theta_3))*sin(theta_4) + (-sin(theta_1)*cos(theta_3) + sin(theta_2)*sin(theta_3)*cos(theta_1))*cos(theta_4)) + Izy_foot*((sin(theta_1)*sin(theta_3) + sin(theta_2)*cos(theta_1)*cos(theta_3))*cos(theta_4) - (-sin(theta_1)*cos(theta_3) + sin(theta_2)*sin(theta_3)*cos(theta_1))*sin(theta_4))) + ((sin(theta_1)*sin(theta_3) + sin(theta_2)*cos(theta_1)*cos(theta_3))*cos(theta_4) - (-sin(theta_1)*cos(theta_3) + sin(theta_2)*sin(theta_3)*cos(theta_1))*sin(theta_4))*(Ixz_foot*cos(theta_1)*cos(theta_2) + Iyz_foot*((sin(theta_1)*sin(theta_3) + sin(theta_2)*cos(theta_1)*cos(theta_3))*sin(theta_4) + (-sin(theta_1)*cos(theta_3) + sin(theta_2)*sin(theta_3)*cos(theta_1))*cos(theta_4)) + Izz_foot*((sin(theta_1)*sin(theta_3) + sin(theta_2)*cos(theta_1)*cos(theta_3))*cos(theta_4) - (-sin(theta_1)*cos(theta_3) + sin(theta_2)*sin(theta_3)*cos(theta_1))*sin(theta_4))) + (Ixx_foot*cos(theta_1)*cos(theta_2) + Iyx_foot*((sin(theta_1)*sin(theta_3) + sin(theta_2)*cos(theta_1)*cos(theta_3))*sin(theta_4) + (-sin(theta_1)*cos(theta_3) + sin(theta_2)*sin(theta_3)*cos(theta_1))*cos(theta_4)) + Izx_foot*((sin(theta_1)*sin(theta_3) + sin(theta_2)*cos(theta_1)*cos(theta_3))*cos(theta_4) - (-sin(theta_1)*cos(theta_3) + sin(theta_2)*sin(theta_3)*cos(theta_1))*sin(theta_4)))*cos(theta_1)*cos(theta_2);
    double B_25 = pow(l6_CoM,2)*m_foot*pow((sin(theta_3 + theta_4 + theta_5)*sin(theta_1)*sin(theta_2) + cos(theta_3 + theta_4 + theta_5)*cos(theta_1)),2) + pow(l6_CoM,2)*m_foot*pow((sin(theta_3 + theta_4 + theta_5)*sin(theta_2)*cos(theta_1) - sin(theta_1)*cos(theta_3 + theta_4 + theta_5)),2) + pow(l6_CoM,2)*m_foot*pow(sin(theta_3 + theta_4 + theta_5),2)*pow(cos(theta_2),2) + ((sin(theta_1)*sin(theta_3) + sin(theta_2)*cos(theta_1)*cos(theta_3))*sin(theta_4) + (-sin(theta_1)*cos(theta_3) + sin(theta_2)*sin(theta_3)*cos(theta_1))*cos(theta_4))*(Ixy_foot*cos(theta_1)*cos(theta_2) + Iyy_foot*((sin(theta_1)*sin(theta_3) + sin(theta_2)*cos(theta_1)*cos(theta_3))*sin(theta_4) + (-sin(theta_1)*cos(theta_3) + sin(theta_2)*sin(theta_3)*cos(theta_1))*cos(theta_4)) + Izy_foot*((sin(theta_1)*sin(theta_3) + sin(theta_2)*cos(theta_1)*cos(theta_3))*cos(theta_4) - (-sin(theta_1)*cos(theta_3) + sin(theta_2)*sin(theta_3)*cos(theta_1))*sin(theta_4))) + ((sin(theta_1)*sin(theta_3) + sin(theta_2)*cos(theta_1)*cos(theta_3))*cos(theta_4) - (-sin(theta_1)*cos(theta_3) + sin(theta_2)*sin(theta_3)*cos(theta_1))*sin(theta_4))*(Ixz_foot*cos(theta_1)*cos(theta_2) + Iyz_foot*((sin(theta_1)*sin(theta_3) + sin(theta_2)*cos(theta_1)*cos(theta_3))*sin(theta_4) + (-sin(theta_1)*cos(theta_3) + sin(theta_2)*sin(theta_3)*cos(theta_1))*cos(theta_4)) + Izz_foot*((sin(theta_1)*sin(theta_3) + sin(theta_2)*cos(theta_1)*cos(theta_3))*cos(theta_4) - (-sin(theta_1)*cos(theta_3) + sin(theta_2)*sin(theta_3)*cos(theta_1))*sin(theta_4))) + (Ixx_foot*cos(theta_1)*cos(theta_2) + Iyx_foot*((sin(theta_1)*sin(theta_3) + sin(theta_2)*cos(theta_1)*cos(theta_3))*sin(theta_4) + (-sin(theta_1)*cos(theta_3) + sin(theta_2)*sin(theta_3)*cos(theta_1))*cos(theta_4)) + Izx_foot*((sin(theta_1)*sin(theta_3) + sin(theta_2)*cos(theta_1)*cos(theta_3))*cos(theta_4) - (-sin(theta_1)*cos(theta_3) + sin(theta_2)*sin(theta_3)*cos(theta_1))*sin(theta_4)))*cos(theta_1)*cos(theta_2);
    
    B_left_leg << B_1, B_2, B_3, B_4, B_5,
                  B_6, B_7, B_8, B_9, B_10,
                  B_11, B_12, B_13, B_14, B_15,
                  B_16, B_17, B_18, B_19, B_20,
                  B_21, B_22, B_23, B_24, B_25;
}

void update_G_left_leg(double theta_1, double theta_2, double theta_3, double theta_4, double theta_5) {
    
    double g1 = 0;
    double g2 = g*l3_CoM*m_hip1*sin(theta_2) + g*m_foot*(l6_CoM*cos(theta_3 + theta_4 + theta_5) + l3 + l4*cos(theta_3) + l5*cos(theta_3 + theta_4))*sin(theta_2) + g*m_ll*(l5_CoM*cos(theta_3 + theta_4) + l3 + l4*cos(theta_3))*sin(theta_2) + g*m_ul*(l4_CoM*cos(theta_3) + l3)*sin(theta_2);
    double g3 = g*l4_CoM*m_ul*sin(theta_3)*cos(theta_2) + g*m_foot*(l6_CoM*sin(theta_3 + theta_4 + theta_5) + l4*sin(theta_3) + l5*sin(theta_3 + theta_4))*cos(theta_2) + g*m_ll*(l5_CoM*sin(theta_3 + theta_4) + l4*sin(theta_3))*cos(theta_2);
    double g4 = g*l5_CoM*m_ll*sin(theta_3 + theta_4)*cos(theta_2) + g*m_foot*(l6_CoM*sin(theta_3 + theta_4 + theta_5) + l5*sin(theta_3 + theta_4))*cos(theta_2);
    double g5 = g*l6_CoM*m_foot*sin(theta_3 + theta_4 + theta_5)*cos(theta_2);

    G_left_leg << g1, g2, g3, g4, g5;
}


void update_J_foot_left_leg(double theta_1, double theta_2, double theta_3, double theta_4, double theta_5) {

    double J_foot_1 = l3*sin(theta_1)*sin(theta_2) + l4*sin(theta_1)*sin(theta_2)*cos(theta_3) - l4*sin(theta_3)*cos(theta_1) - l5*sin(theta_3 + theta_4)*cos(theta_1) + l5*sin(theta_1)*sin(theta_2)*cos(theta_3 + theta_4) - l6*sin(theta_3 + theta_4 + theta_5)*cos(theta_1) + l6*sin(theta_1)*sin(theta_2)*cos(theta_3 + theta_4 + theta_5);
    double J_foot_2 = -(l3 + l4*cos(theta_3) + l5*cos(theta_3 + theta_4) + l6*cos(theta_3 + theta_4 + theta_5))*cos(theta_1)*cos(theta_2);
    double J_foot_3 = -l4*sin(theta_1)*cos(theta_3) + l4*sin(theta_2)*sin(theta_3)*cos(theta_1) + l5*sin(theta_3 + theta_4)*sin(theta_2)*cos(theta_1) - l5*sin(theta_1)*cos(theta_3 + theta_4) + l6*sin(theta_3 + theta_4 + theta_5)*sin(theta_2)*cos(theta_1) - l6*sin(theta_1)*cos(theta_3 + theta_4 + theta_5);
    double J_foot_4 = l5*sin(theta_3 + theta_4)*sin(theta_2)*cos(theta_1) - l5*sin(theta_1)*cos(theta_3 + theta_4) + l6*sin(theta_3 + theta_4 + theta_5)*sin(theta_2)*cos(theta_1) - l6*sin(theta_1)*cos(theta_3 + theta_4 + theta_5);
    double J_foot_5 = l6*(sin(theta_3 + theta_4 + theta_5)*sin(theta_2)*cos(theta_1) - sin(theta_1)*cos(theta_3 + theta_4 + theta_5));
    double J_foot_6 = -l3*sin(theta_2)*cos(theta_1) - l4*sin(theta_1)*sin(theta_3) - l4*sin(theta_2)*cos(theta_1)*cos(theta_3) - l5*sin(theta_3 + theta_4)*sin(theta_1) - l5*sin(theta_2)*cos(theta_3 + theta_4)*cos(theta_1) - l6*sin(theta_3 + theta_4 + theta_5)*sin(theta_1) - l6*sin(theta_2)*cos(theta_3 + theta_4 + theta_5)*cos(theta_1);
    double J_foot_7 = -(l3 + l4*cos(theta_3) + l5*cos(theta_3 + theta_4) + l6*cos(theta_3 + theta_4 + theta_5))*sin(theta_1)*cos(theta_2);
    double J_foot_8 = l4*(sin(theta_1)*sin(theta_2)*sin(theta_3) + cos(theta_1)*cos(theta_3)) + l5*(sin(theta_3 + theta_4)*sin(theta_1)*sin(theta_2) + cos(theta_3 + theta_4)*cos(theta_1)) + l6*(sin(theta_3 + theta_4 + theta_5)*sin(theta_1)*sin(theta_2) + cos(theta_3 + theta_4 + theta_5)*cos(theta_1));
    double J_foot_9 = l5*(sin(theta_3 + theta_4)*sin(theta_1)*sin(theta_2) + cos(theta_3 + theta_4)*cos(theta_1)) + l6*(sin(theta_3 + theta_4 + theta_5)*sin(theta_1)*sin(theta_2) + cos(theta_3 + theta_4 + theta_5)*cos(theta_1));
    double J_foot_10 = l6*(sin(theta_3 + theta_4 + theta_5)*sin(theta_1)*sin(theta_2) + cos(theta_3 + theta_4 + theta_5)*cos(theta_1));
    double J_foot_11 = 0;
    double J_foot_12 = (l3 + l4*cos(theta_3) + l5*cos(theta_3 + theta_4) + l6*cos(theta_3 + theta_4 + theta_5))*sin(theta_2);
    double J_foot_13 = (l4*sin(theta_3) + l5*sin(theta_3 + theta_4) + l6*sin(theta_3 + theta_4 + theta_5))*cos(theta_2);
    double J_foot_14 = (l5*sin(theta_3 + theta_4) + l6*sin(theta_3 + theta_4 + theta_5))*cos(theta_2);
    double J_foot_15 = l6*sin(theta_3 + theta_4 + theta_5)*cos(theta_2);

    J_foot_left_leg << J_foot_1, J_foot_2, J_foot_3, J_foot_4, J_foot_5,
                        J_foot_6, J_foot_7, J_foot_8, J_foot_9, J_foot_10,
                        J_foot_11, J_foot_12, J_foot_13, J_foot_14, J_foot_15;
}

void update_J_foot_dot_left_leg(double theta_1, double theta_2, double theta_3, double theta_4, double theta_5, double thetadot1, double thetadot2, double thetadot3, double thetadot4, double thetadot5) {

    double J_foot_dot_1 = l3*thetadot1*sin(theta_2)*cos(theta_1) + l3*thetadot2*sin(theta_1)*cos(theta_2) + l4*thetadot1*sin(theta_1)*sin(theta_3) + l4*thetadot1*sin(theta_2)*cos(theta_1)*cos(theta_3) + l4*thetadot2*sin(theta_1)*cos(theta_2)*cos(theta_3) - l4*thetadot3*sin(theta_1)*sin(theta_2)*sin(theta_3) - l4*thetadot3*cos(theta_1)*cos(theta_3) - l5*(thetadot3 + thetadot4)*sin(theta_3 + theta_4)*sin(theta_1)*sin(theta_2) - l5*(thetadot3 + thetadot4)*cos(theta_3 + theta_4)*cos(theta_1) + l5*thetadot1*sin(theta_3 + theta_4)*sin(theta_1) + l5*thetadot1*sin(theta_2)*cos(theta_3 + theta_4)*cos(theta_1) + l5*thetadot2*sin(theta_1)*cos(theta_3 + theta_4)*cos(theta_2) - l6*(thetadot3 + thetadot4 + thetadot5)*sin(theta_3 + theta_4 + theta_5)*sin(theta_1)*sin(theta_2) - l6*(thetadot3 + thetadot4 + thetadot5)*cos(theta_3 + theta_4 + theta_5)*cos(theta_1) + l6*thetadot1*sin(theta_3 + theta_4 + theta_5)*sin(theta_1) + l6*thetadot1*sin(theta_2)*cos(theta_3 + theta_4 + theta_5)*cos(theta_1) + l6*thetadot2*sin(theta_1)*cos(theta_3 + theta_4 + theta_5)*cos(theta_2);
    double J_foot_dot_2 = (l4*thetadot3*sin(theta_3) + l5*(thetadot3 + thetadot4)*sin(theta_3 + theta_4) + l6*(thetadot3 + thetadot4 + thetadot5)*sin(theta_3 + theta_4 + theta_5))*cos(theta_1)*cos(theta_2) + (l3 + l4*cos(theta_3) + l5*cos(theta_3 + theta_4) + l6*cos(theta_3 + theta_4 + theta_5))*thetadot1*sin(theta_1)*cos(theta_2) + (l3 + l4*cos(theta_3) + l5*cos(theta_3 + theta_4) + l6*cos(theta_3 + theta_4 + theta_5))*thetadot2*sin(theta_2)*cos(theta_1);
    double J_foot_dot_3 = -l4*thetadot1*sin(theta_1)*sin(theta_2)*sin(theta_3) - l4*thetadot1*cos(theta_1)*cos(theta_3) + l4*thetadot2*sin(theta_3)*cos(theta_1)*cos(theta_2) + l4*thetadot3*sin(theta_1)*sin(theta_3) + l4*thetadot3*sin(theta_2)*cos(theta_1)*cos(theta_3) + l5*(thetadot3 + thetadot4)*sin(theta_3 + theta_4)*sin(theta_1) + l5*(thetadot3 + thetadot4)*sin(theta_2)*cos(theta_3 + theta_4)*cos(theta_1) - l5*thetadot1*sin(theta_3 + theta_4)*sin(theta_1)*sin(theta_2) - l5*thetadot1*cos(theta_3 + theta_4)*cos(theta_1) + l5*thetadot2*sin(theta_3 + theta_4)*cos(theta_1)*cos(theta_2) + l6*(thetadot3 + thetadot4 + thetadot5)*sin(theta_3 + theta_4 + theta_5)*sin(theta_1) + l6*(thetadot3 + thetadot4 + thetadot5)*sin(theta_2)*cos(theta_3 + theta_4 + theta_5)*cos(theta_1) - l6*thetadot1*sin(theta_3 + theta_4 + theta_5)*sin(theta_1)*sin(theta_2) - l6*thetadot1*cos(theta_3 + theta_4 + theta_5)*cos(theta_1) + l6*thetadot2*sin(theta_3 + theta_4 + theta_5)*cos(theta_1)*cos(theta_2);
    double J_foot_dot_4 = l5*(thetadot3 + thetadot4)*sin(theta_3 + theta_4)*sin(theta_1) + l5*(thetadot3 + thetadot4)*sin(theta_2)*cos(theta_3 + theta_4)*cos(theta_1) - l5*thetadot1*sin(theta_3 + theta_4)*sin(theta_1)*sin(theta_2) - l5*thetadot1*cos(theta_3 + theta_4)*cos(theta_1) + l5*thetadot2*sin(theta_3 + theta_4)*cos(theta_1)*cos(theta_2) + l6*(thetadot3 + thetadot4 + thetadot5)*sin(theta_3 + theta_4 + theta_5)*sin(theta_1) + l6*(thetadot3 + thetadot4 + thetadot5)*sin(theta_2)*cos(theta_3 + theta_4 + theta_5)*cos(theta_1) - l6*thetadot1*sin(theta_3 + theta_4 + theta_5)*sin(theta_1)*sin(theta_2) - l6*thetadot1*cos(theta_3 + theta_4 + theta_5)*cos(theta_1) + l6*thetadot2*sin(theta_3 + theta_4 + theta_5)*cos(theta_1)*cos(theta_2);
    double J_foot_dot_5 = l6*((thetadot3 + thetadot4 + thetadot5)*sin(theta_3 + theta_4 + theta_5)*sin(theta_1) + (thetadot3 + thetadot4 + thetadot5)*sin(theta_2)*cos(theta_3 + theta_4 + theta_5)*cos(theta_1) - thetadot1*sin(theta_3 + theta_4 + theta_5)*sin(theta_1)*sin(theta_2) - thetadot1*cos(theta_3 + theta_4 + theta_5)*cos(theta_1) + thetadot2*sin(theta_3 + theta_4 + theta_5)*cos(theta_1)*cos(theta_2));
    double J_foot_dot_6 = l3*thetadot1*sin(theta_1)*sin(theta_2) - l3*thetadot2*cos(theta_1)*cos(theta_2) + l4*thetadot1*sin(theta_1)*sin(theta_2)*cos(theta_3) - l4*thetadot1*sin(theta_3)*cos(theta_1) - l4*thetadot2*cos(theta_1)*cos(theta_2)*cos(theta_3) - l4*thetadot3*sin(theta_1)*cos(theta_3) + l4*thetadot3*sin(theta_2)*sin(theta_3)*cos(theta_1) + l5*(thetadot3 + thetadot4)*sin(theta_3 + theta_4)*sin(theta_2)*cos(theta_1) - l5*(thetadot3 + thetadot4)*sin(theta_1)*cos(theta_3 + theta_4) - l5*thetadot1*sin(theta_3 + theta_4)*cos(theta_1) + l5*thetadot1*sin(theta_1)*sin(theta_2)*cos(theta_3 + theta_4) - l5*thetadot2*cos(theta_3 + theta_4)*cos(theta_1)*cos(theta_2) + l6*(thetadot3 + thetadot4 + thetadot5)*sin(theta_3 + theta_4 + theta_5)*sin(theta_2)*cos(theta_1) - l6*(thetadot3 + thetadot4 + thetadot5)*sin(theta_1)*cos(theta_3 + theta_4 + theta_5) - l6*thetadot1*sin(theta_3 + theta_4 + theta_5)*cos(theta_1) + l6*thetadot1*sin(theta_1)*sin(theta_2)*cos(theta_3 + theta_4 + theta_5) - l6*thetadot2*cos(theta_3 + theta_4 + theta_5)*cos(theta_1)*cos(theta_2);
    double J_foot_dot_7 = (l4*thetadot3*sin(theta_3) + l5*(thetadot3 + thetadot4)*sin(theta_3 + theta_4) + l6*(thetadot3 + thetadot4 + thetadot5)*sin(theta_3 + theta_4 + theta_5))*sin(theta_1)*cos(theta_2) - (l3 + l4*cos(theta_3) + l5*cos(theta_3 + theta_4) + l6*cos(theta_3 + theta_4 + theta_5))*thetadot1*cos(theta_1)*cos(theta_2) + (l3 + l4*cos(theta_3) + l5*cos(theta_3 + theta_4) + l6*cos(theta_3 + theta_4 + theta_5))*thetadot2*sin(theta_1)*sin(theta_2);
    double J_foot_dot_8 = l4*(-thetadot1*sin(theta_1)*cos(theta_3) + thetadot1*sin(theta_2)*sin(theta_3)*cos(theta_1) + thetadot2*sin(theta_1)*sin(theta_3)*cos(theta_2) + thetadot3*sin(theta_1)*sin(theta_2)*cos(theta_3) - thetadot3*sin(theta_3)*cos(theta_1)) + l5*(-(thetadot3 + thetadot4)*sin(theta_3 + theta_4)*cos(theta_1) + (thetadot3 + thetadot4)*sin(theta_1)*sin(theta_2)*cos(theta_3 + theta_4) + thetadot1*sin(theta_3 + theta_4)*sin(theta_2)*cos(theta_1) - thetadot1*sin(theta_1)*cos(theta_3 + theta_4) + thetadot2*sin(theta_3 + theta_4)*sin(theta_1)*cos(theta_2)) + l6*(-(thetadot3 + thetadot4 + thetadot5)*sin(theta_3 + theta_4 + theta_5)*cos(theta_1) + (thetadot3 + thetadot4 + thetadot5)*sin(theta_1)*sin(theta_2)*cos(theta_3 + theta_4 + theta_5) + thetadot1*sin(theta_3 + theta_4 + theta_5)*sin(theta_2)*cos(theta_1) - thetadot1*sin(theta_1)*cos(theta_3 + theta_4 + theta_5) + thetadot2*sin(theta_3 + theta_4 + theta_5)*sin(theta_1)*cos(theta_2));
    double J_foot_dot_9 = l5*(-(thetadot3 + thetadot4)*sin(theta_3 + theta_4)*cos(theta_1) + (thetadot3 + thetadot4)*sin(theta_1)*sin(theta_2)*cos(theta_3 + theta_4) + thetadot1*sin(theta_3 + theta_4)*sin(theta_2)*cos(theta_1) - thetadot1*sin(theta_1)*cos(theta_3 + theta_4) + thetadot2*sin(theta_3 + theta_4)*sin(theta_1)*cos(theta_2)) + l6*(-(thetadot3 + thetadot4 + thetadot5)*sin(theta_3 + theta_4 + theta_5)*cos(theta_1) + (thetadot3 + thetadot4 + thetadot5)*sin(theta_1)*sin(theta_2)*cos(theta_3 + theta_4 + theta_5) + thetadot1*sin(theta_3 + theta_4 + theta_5)*sin(theta_2)*cos(theta_1) - thetadot1*sin(theta_1)*cos(theta_3 + theta_4 + theta_5) + thetadot2*sin(theta_3 + theta_4 + theta_5)*sin(theta_1)*cos(theta_2));
    double J_foot_dot_10 = l6*(-(thetadot3 + thetadot4 + thetadot5)*sin(theta_3 + theta_4 + theta_5)*cos(theta_1) + (thetadot3 + thetadot4 + thetadot5)*sin(theta_1)*sin(theta_2)*cos(theta_3 + theta_4 + theta_5) + thetadot1*sin(theta_3 + theta_4 + theta_5)*sin(theta_2)*cos(theta_1) - thetadot1*sin(theta_1)*cos(theta_3 + theta_4 + theta_5) + thetadot2*sin(theta_3 + theta_4 + theta_5)*sin(theta_1)*cos(theta_2));
    double J_foot_dot_11 = 0;
    double J_foot_dot_12 = -(l4*thetadot3*sin(theta_3) + l5*(thetadot3 + thetadot4)*sin(theta_3 + theta_4) + l6*(thetadot3 + thetadot4 + thetadot5)*sin(theta_3 + theta_4 + theta_5))*sin(theta_2) + (l3 + l4*cos(theta_3) + l5*cos(theta_3 + theta_4) + l6*cos(theta_3 + theta_4 + theta_5))*thetadot2*cos(theta_2);
    double J_foot_dot_13 = -(l4*sin(theta_3) + l5*sin(theta_3 + theta_4) + l6*sin(theta_3 + theta_4 + theta_5))*thetadot2*sin(theta_2) + (l4*thetadot3*cos(theta_3) + l5*(thetadot3 + thetadot4)*cos(theta_3 + theta_4) + l6*(thetadot3 + thetadot4 + thetadot5)*cos(theta_3 + theta_4 + theta_5))*cos(theta_2);
    double J_foot_dot_14 = -(l5*sin(theta_3 + theta_4) + l6*sin(theta_3 + theta_4 + theta_5))*thetadot2*sin(theta_2) + (l5*(thetadot3 + thetadot4)*cos(theta_3 + theta_4) + l6*(thetadot3 + thetadot4 + thetadot5)*cos(theta_3 + theta_4 + theta_5))*cos(theta_2);
    double J_foot_dot_15 = l6*((thetadot3 + thetadot4 + thetadot5)*cos(theta_3 + theta_4 + theta_5)*cos(theta_2) - thetadot2*sin(theta_3 + theta_4 + theta_5)*sin(theta_2));
    
    J_foot_dot_left_leg << J_foot_dot_1, J_foot_dot_2, J_foot_dot_3, J_foot_dot_4, J_foot_dot_5,
                            J_foot_dot_6, J_foot_dot_7, J_foot_dot_8, J_foot_dot_9, J_foot_dot_10,
                            J_foot_dot_11, J_foot_dot_12, J_foot_dot_13, J_foot_dot_14, J_foot_dot_15;
}

void update_Lambda_left_leg() {
    // Lambda_t = np.linalg.inv(J_t.dot(B_t_inv).dot(J_t.T))
    Lambda_left_leg = (J_foot_left_leg * B_left_leg.inverse() * J_foot_left_leg.transpose()).inverse();
}

void update_Kp_left_leg() {
    Kp_left_leg << pow(omega_desired, 2) * Lambda_left_leg(0, 0), 0, 0,
                    0, pow(omega_desired, 2) * Lambda_left_leg(1, 1), 0,
                    0, 0, pow(omega_desired, 2) * Lambda_left_leg(2, 2);
    // Kp_left_leg << 1, 0, 0,
    //                 0, 1, 0,
    //                 0, 0, 1;
}

void update_Kd_left_leg() {
    Kd_left_leg << 0.6, 0, 0,
                   0, 0.6, 0,
                   0, 0, 0.6;
}

void update_tau_ff_left_leg() {
    //tau_ff = J_t.T.dot(Lambda_t).dot(a_des - J_dot_t.dot(q_dot_t)) + C_t + g_t
    tau_ff_left_leg = G_left_leg /* + C* + J_foot.transpose() * Lambda * (accel_desired - J_foot_dot * q_dot)*/;
}

void update_foot_pos_left_leg(double theta_1, double theta_2, double theta_3, double theta_4, double theta_5) {
    double foot_pos_1 = -l3*sin(theta_2)*cos(theta_1) - l4*sin(theta_1)*sin(theta_3) - l4*sin(theta_2)*cos(theta_1)*cos(theta_3) - l5*sin(theta_3 + theta_4)*sin(theta_1) - l5*sin(theta_2)*cos(theta_3 + theta_4)*cos(theta_1) - l6*sin(theta_3 + theta_4 + theta_5)*sin(theta_1) - l6*sin(theta_2)*cos(theta_3 + theta_4 + theta_5)*cos(theta_1);
    double foot_pos_2 = -l3*sin(theta_1)*sin(theta_2) - l4*(sin(theta_1)*sin(theta_2)*cos(theta_3) - sin(theta_3)*cos(theta_1)) + l5*(sin(theta_3 + theta_4)*cos(theta_1) - sin(theta_1)*sin(theta_2)*cos(theta_3 + theta_4)) + l6*(sin(theta_3 + theta_4 + theta_5)*cos(theta_1) - sin(theta_1)*sin(theta_2)*cos(theta_3 + theta_4 + theta_5));
    double foot_pos_3 = -l1 - l2 - l3*cos(theta_2) - l4*cos(theta_2)*cos(theta_3) - l5*cos(theta_3 + theta_4)*cos(theta_2) - l6*cos(theta_3 + theta_4 + theta_5)*cos(theta_2);

    foot_pos_left_leg << foot_pos_1,
                         foot_pos_2,
                         foot_pos_3;
}

void update_foot_vel_left_leg(Eigen::Matrix<double, 5, 1> q_dot) {
    foot_vel_left_leg = J_foot_left_leg * q_dot;
}

void update_tau_setpoint_left_leg() {
    //tau_setpoint_t = J_t.T.dot(K_p.dot(p_des - p_t) + K_d.dot(v_des - v_t)) + tau_ff_t
    tau_setpoint_left_leg = J_foot_left_leg.transpose() * (Kp_left_leg * (pos_desired_left_leg - foot_pos_left_leg) + Kd_left_leg * (vel_desired_left_leg - foot_vel_left_leg)) + tau_ff_left_leg;
}

#pragma endregion Left leg